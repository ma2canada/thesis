%\chapter{Ch2-SymmetricLogistic}
\chapter{Going from Two Species to One}

%NTS:::
%explain truly neutral vs unbiased
%generalized LV, expansion of coupled log
%NTS:::somewhere (maybe Ch2) need to be explicit what is meant by neutral, what is meant by simply symmetric
%NTS:::can talk about fitness (here or later)
%NTS:::limiting factors argument
%NTS:::why MTE is important
%NTS:::conditional
%NTS:::in INTRO or should mention birth-death, as opposed to other discrete space Markov models
%NTS:::in INTRO or maybe should also mention Markov at some point
%NTS:::add Kessler2015 to those that observe the Moran limit and treat the LV model stochastically
%NTS:::be clear in chapters 2 and 3 that I am choosing interactions to affect death rate

\iffalse
"strategic lit review"
"gap"
"thesis" "in this paper I will..."
"roadmap"
"short significance"
\fi


%\section*{pre-intro note}
This chapter is based on a paper written by me and my supervisor Anton Zilman, which will be published in a Royal Society journal \cite{Badali2018}. 

\section{Introduction}

\iffalse
Remarkable biodiversity exists in biomes such as the human microbiome \cite{Korem2015,Coburn2015,Palmer2001}, the ocean surface \cite{Hutchinson1961,Cordero2016}, soil \cite{Friedman2016}, the immune system \cite{Weinstein2009,Desponds2015,Stirk2010} and other ecosystems \cite{Tilman1996,Naeem2001}. 
Quantitative predictive understanding of long term population behavior of complex populations is important for many practical applications in human health and disease \cite{Coburn2015,Palmer2001,Kinross2011}, industrial processes \cite{Wolfe2014}, maintenance of drug resistance plasmids in bacteria \cite{Gooding-townsend2015}, cancer progression \cite{Ashcroft2015}, and evolutionary phylogeny inference algorithms \cite{Kingman1982,Rice2004,Blythe2007}. 
Nevertheless, the long term dynamics, diversity and stability of communities of multiple interacting species are still incompletely understood.
%NTS:::some of this stuff would also be good to say in the introduction - significance
%summary: biodiversity exists and is useful to know but is not completely understood

%summary: competitive exclusion says one species per niche, but niches are not understood. Also, Hubbell
%One common theory, known as the Gause's rule or the competitive exclusion principle, postulates that due to abiotic constraints, resource usage, inter-species interactions, and other factors, ecosystems can be divided into ecological niches, with each niche supporting only one species in steady state, and that species is said to have fixated \cite{Hardin1960,Mayfield2010,Kimura1968,Nadell2013}. 
The competitive exclusion principle postulates that due to abiotic constraints, resource usage, inter-species interactions, and other factors, ecosystems can be divided into ecological niches, with each niche supporting only one species in steady state, and that species is said to have fixated \cite{Hardin1960,Mayfield2010,Kimura1968,Nadell2013}. 
However, the exact definition of an ecological niche varies and is still a subject of debate \cite{Leibold1995,Hutchinson1961,Abrams1980,Chesson2000,Adler2010,Capitan2017,Fisher2014}, and maintenance of biodiversity of species that occupy similar niches is still not fully understood \cite{May1999,Pennisi2005,Posfai2017}. 
Commonly, the number of ecological niches can be related to the number of limiting factors that affect growth and death rates, such as metabolic resources or secreted molecular signals like growth factors or toxins, or other regulatory molecules \cite{Armstrong1976,McGehee1977a,Armstrong1980,Posfai2017}. 
Observed biodiversity can also arise from the turnover of transient mutants or immigrants that appear and go extinct in the population, as in Hubbell's model \cite{Hubbell2001,Desai2007,Carroll2015}.
\fi

%competitive exclusion, paradox of the plankton, hubbell
The previous chapter treated the tractable problem of a single species undergoing only intraspecies interactions. 
Adding a second species complicates both the mathematics and the biology, but offers possible resolutions to the problem of biodiversity. 
Competitive exclusion suggests that only one species will persist in each ecological niche \cite{competitive ???}, but ecosystems like the ocean surface seem to have more species than there are niches \cite{Hutchinson1961}. %NTS:::
Niche and neutral models both address this ``paradox of the plankton'' but a resolution remains elusive. 
Further study is required. 

%summary:deterministic; stochastic; neutral; LV to neutral

Deterministically, ecological dynamics of mixed populations have commonly been described using a dynamical system of the numbers of individuals of each species and the concentrations of the limiting factors \cite{Armstrong1976,McGehee1977a,Armstrong1980}. 
Steady state coexistence typically corresponds to a stable fixed point in such dynamical system, and the number of stably coexisting species is typically constrained by the number of limiting factors. 
In some cases, deterministic models allow coexistence of more species than limiting factors, for instance when the attractor is a limit cycle rather than a point \cite{Smale1976,Armstrong1980}. 
Particularly pertinent for this chapter is the case when the interactions of the limiting factors and the target species have a redundancy that results in the transformation of a stable fixed point into a marginally stable manifold of fixed points. 
Then the stochastic fluctuations in the species numbers become important \cite{Volterra1926,Armstrong1980,Bomze1983,Chesson1990,Antal2006,Posfai2017}. 
I will return to the mathematical formulation of these concepts later. %NTS:::could expand these last two sentences. 

Stochastic effects, arising either from the extrinsic fluctuations of the environment \cite{Kamenev2008a,Chotibut2017b}, or the intrinsic stochasticity of individual birth and death events within the population \cite{Assaf2006,Gottesman2012,Dobrinevski2012,Gabel2013,Fisher2014,Constable2015,Lin2012,Chotibut2015,Young2018}, modify the deterministic picture. 
As in the previous chapter, I focus on this latter type of stochasticity, known as demographic noise. 
Demographic noise causes fluctuations of the populations abundances around the deterministic steady state until a rare large fluctuation leads to extinction of one of the species \cite{Kimura1968,Lin2012,Chotibut2015}. 
In systems with a deterministically stable coexistence point, the mean time to extinction is typically exponential in the population size \cite{Norden1982,Kamenev2008,Assaf2010,Ovaskainen2010}, as was seen in the previous chapter. 
Exponential scaling is commonly considered to imply stable long term coexistence for typical biological examples with relatively large numbers of individuals \cite{Ovaskainen2010,Lin2015}. 

By contrast, in systems with a neutral manifold that restore fluctuations off the manifold but not along it, mean extinction timescales as a power law with the population size, indicating that the coexistence fails in such systems on biologically relevant timescales \cite{Kimura1955,Moran1962,Lin2012,Chotibut2017a}. 
This type of stochastic dynamics parallels the stochastic fixation in the classical Moran-Fisher-Wright model that describes strongly competing populations with fixed overall population size \cite{Wright1931,Fisher1930,Moran1962,Kimura1968,Rice2004,Rogers2014,Stirk2010,Capitan2017}.

%A broad class of dynamical models (reviewed below) of multi-species populations interacting through limiting factors can be mapped onto the class of models known as generalized Lotka-Volterra (LV) models, which allow one to conveniently distinguish between various interaction regimes, such as competition or mutualism, and which have served as paradigmatic models for the study of the behavior of interacting species \cite{Volterra1926,Bomze1983,Chesson1990,Antal2006,Chotibut2015,Dobrinevski2012,Fisher2014,Constable2015,Lin2012,Gabel2013,Kessler2015,Young2018}. %NTS:::could expand on LV, either here or in intro or both. 
As is reviewed below, a broad class of dynamical models of multi-species populations interacting through limiting factors can be mapped onto the generalized Lotka-Volterra model. 
Lotka-Volterra models allow one to conveniently distinguish between various interaction regimes, such as competition or mutualism, and which have served as paradigmatic models for the study of the behavior of interacting species \cite{Volterra1926,Bomze1983,Chesson1990,Antal2006,Chotibut2015,Dobrinevski2012,Fisher2014,Constable2015,Lin2012,Gabel2013,Kessler2015,Young2018}. 
Remarkably, the stochastic dynamics of LV type models is still incompletely understood, and has recently received renewed attention motivated by problems in bacterial ecology and cancer progression \cite{VanMelderen2009,Stirk2010,Fisher2014,Chotibut2015,Capitan2017,Kessler2014}. %cut Nowak 2006.%NTS:::I can change [remove?] this [sentence?]!!!
There has also been the observation that for certain parameter values that the stochastic 2D generalized Lotka-Volterra model exhibits similar dynamics to the Moran model \cite{Lin2012,Constable2015,Chotibut2015,Young2018}. 
How the system transitions from the typical LV results of MTE scaling exponentially with system size to the algebraic times of the Moran model is the main result of this chapter. 
The results outline the conditions of niche overlap and carrying capacity that allow two species to coexist (and conversely, those that will lead to relatively quick fixation). 

In this chapter, I analyze a model of two competing species with the emphasis on the transition from deterministic coexistence to stochastic fixation. %, and the population stability with respect to mutation and invasion. 
I use the master equation and first passage formalism that enables numerically solution to arbitrary accuracy in all regimes. %NTS:::this was not introduced in chapter 1
First I will provide a definition of ecological niche [do I?!?] and a derivation of the competitive LV model, and examine its regimes of deterministic stability. %NTS:::do I?!?
Then I will introduce the stochastic description of the LV model and analyze fixation times as a function of the niche overlap between the two species. 
These results will be compared to known analytic limits, included here for completeness. 
I will make further comparisons to the Fokker-Planck and WKB approximations before concluding with a general discussion of the results. 
%Finally we conclude with a discussion of our results in the context of previous works, and potential experimental implications.
%NTS:::more detailed roadmap?


%\section{Deterministic Description}
\section{Long-term stability of deterministic interacting populations}
%NTS:::this section could be expanded a bit, maybe with a cartoony figure of nullclines converging. 
%NTS:::consider also uncommenting the commented out swath. 
%NTS:::in fact I have a longer version somewhere, I could just use that...
%NTS:::yeah, this and the next section should be expanded, to include more discussion, including discussion of (one form of) competitive exclusion!!!
%NTS:::also point out that these two sections are not original (or rather they are, but thirty years too late) but I use them to demonstrate comp excl and niche overlap
Quite generally, the dynamics of a system of $N$ asexually reproducing species that interact with each other only through $M$ limiting factors (such as food, soluble signaling and growth/death factors, toxins, metabolic waste) and experience no immigration can be described by the following system of equations for the species $x_1,...,x_N$ and the limiting factor densities $f_1,...,f_M$ \cite{Armstrong1976,McGehee1977a,Armstrong1980}:
\begin{align}\label{eq-xi}
\dot{x}_i &= \beta_i\big(\vec{f}\big)x_i - \mu_i\big(\vec{f}\big) x_i,
\end{align}
where $\vec{f}$ is the state of all factors that might affect the per capita birth rate $\beta_i\big(\vec{f}\big)$  and the death rate $\mu_i\big(\vec{f}\big)$ of the species $i$.

The density of a factor $j$ in the environment, $f_j$, follows its own dynamical production-consumption equation
\begin{align}\label{eq-fj}
\dot{f}_j &= g_j(\vec{f},\vec{x}) - \lambda_j(\vec{f},\vec{x}) f_j
\end{align}
where  $g_j$ is a production-consumption rate that includes both the secretion and the consumption by the participating species as well any external sources of the factor $f_j$, and $\lambda_j$ is its degradation rate. Alternatively, for some abiotic constrains such as physical space or amount of sunlight, the concentration of the factor $f_j$ can be set through a conservation equation of a form \cite{McGehee1977a,Armstrong1980} $f_j = c_j(\vec{f},\vec{x})$.

%NTS:::address Matt's comments. In particular, if $r_1 \equiv \beta_1-\mu_1$ has one same root as $r_2$ then a fixed point exists (albeit with a zero eigenvalue, hence a line of fixed points) - it's not a matter of (in)dependence, but of having the same solutions or not
The fixed points of the $N+M$ equations (\ref{eq-xi}) and (\ref{eq-fj}) determine the steady state numbers of each of the $N$ species and the corresponding concentrations of the $M$ limiting factors. However, the structure of equations (\ref{eq-xi}) imposes additional constraints on the steady state solutions: at a fixed point $\beta_i\big(\vec{f}\big) = \mu_i\big(\vec{f}\big)$ for each of the $N$ species, which determines the steady state concentrations of the $M$ limiting factors $\vec{f}$. %$r_i(\vec{f})\equiv\beta_i\big(\vec{f}\big)- \mu_i\big(\vec{f}\big)=0$
However, if $N>M$, the system (\ref{eq-xi}) of $N$ equations is over-determined and typically does not have a consistent solution, unless the fixed point populations of $N-M$ of the species are equal to zero \cite{Armstrong1976,McGehee1977a,Armstrong1980,Fisher2015,Posfai2017}. 
This reasoning provides a mathematical basis for the competitive exclusion principle, whereby the number of independent niches is determined by the number of limiting factors, and a system with $M$ resources can sustain at most $M$ species in steady state. %you can also get "competitive exclusion" deterministically if the competition parameter(s) (niche overlap) is sufficiently large (eg. a>1), at which point you can only have one species or the other; the point is, there are a couple things called competitive exclusion, and a couple ways to show it, but the way shown here is one contributor

Nevertheless, as mentioned in the introduction, the number of species at the steady state can exceed the number of limiting factors, when the $N$ equations for the species are not independent and thus provide less than $N$ constraints on the solutions. 
In this case, at steady state the populations of the non-independent species typically converge onto a marginally stable manifold on which each point is stable with respect to off-manifold perturbations but is neutral within the manifold \cite{McGehee1977a,Case1979,Lin2012,Antal2006,Dobrinevski2012}. 
I return to this point in the following sections within the discussion of the Lotka-Volterra model. %NTS:::this paragraph could be expanded. 


\section{Minimal model of interacting species and the derivation of 2D LV model} %NTS:::this section can be expanded, see two page summary I wrote on this. 
%NTS:::this SHOULD be expanded, to point out deterministic competitive exclusion - or maybe previous section?
\begin{figure}[h]
	\centering
	\includegraphics[width=0.5\textwidth]{two-resources}
	\caption{\emph{A simple two species two resource model that derives the Lotka-Voltera model} Each of the two species (here, red and blue circles) reproduces (arrows to self) and produces a toxin (arrows to limiting factors, respectively red and blue squares) which inhibits its own growth (square-ending lines to self) and the growth of the other (square-ending lines to other colour). } \label{toxinsfig}
\end{figure}%NTS:::this isn't referenced in the text; furthermore the model in the text is slightly different, with each species producing both waste product

As a minimal example, in this section I introduce a model of two interacting species whose dynamics is constrained by two secreted factors. Each species $x_i$ has basal per capita birth rate $\beta_i$, death rate $\mu_i$, and each generates the secreted soluble factors $t_j$ at rates $g_{ji}$. Each factor $t_i$ is degraded at a rate $\lambda_i$, and affects the death rate of each bacterium linearly with the efficacy $e_{ij}$. Positive $e_{ij}$ may correspond to metabolic wastes, toxins or anti-proliferative signals \cite{Jacob1989,Maplestone1992,VanMelderen2009,Rankin2012,Shen2015,Wynn2015}, while negative $e_{ij}$ would describe growth factors or secondary metabolites \cite{Maplestone1992,Reya2001,Wink2003}. The model kinetics is encapsulated in the following equations for the turnover of the species numbers:
\begin{align}
\dot{x}_1 &= \beta_1 x_1 - \mu_1 x_1 - e_{11} t_1 x_1 - e_{12} t_2 x_1 \notag \\
\dot{x}_2 &= \beta_2 x_2 - \mu_2 x_2 - e_{21} t_1 x_2 - e_{22} t_2 x_2 \label{eq-x-tox},
\end{align}
and the equations for the production and the degradation of the secreted factors:
\begin{align}
\dot{t}_1 &= g_{11} x_1 + g_{12}x_2 - \lambda_1 t_1  \nonumber \\
\dot{t}_2 &= g_{21} x_1 + g_{22}x_2 - \lambda_2 t_2. \label{eq-tox}
\end{align}
%Henceforth we assume that $\lambda_1=\lambda_2=1$[[but why?]] and refer to the secreted factors as toxins.
Figure \ref{toxinsfig} gives a pictoral representation of the interactions of the two species (cirlces) and their associated toxins (squares), albeit with $g_{12}=g_{21}=0$. 

It is useful to recast Equations (\ref{eq-x-tox}), (\ref{eq-tox}) defining vectors $\vec{x}=(x_1,x_2)$ and $\vec{t}=(t_1,t_2)$, so that
\begin{equation}
%\dot{\vec{x}} = \hat{R}\cdot\hat{X} \left( \vec{1} - \hat{E}\cdot \vec{t} \right)\;\;\;\text{and}\;\;\;
%\dot{\vec{t}} = \hat{L}\cdot  \left( \hat{G}\cdot \vec{x} - \vec{t} \right), \label{xdot-tdot-eqn}
\dot{\vec{x}} = \hat{R} \hat{X} \left( \vec{1} - \hat{E} \vec{t} \right)\;\;\;\text{and}\;\;\;
\dot{\vec{t}} = \hat{L} \left( \hat{G} \vec{x} - \vec{t} \right), \label{xdot-tdot-eqn}
\end{equation}
where we have the matrices $\hat{X} = \begin{pmatrix}
x_1 & 0 \\
0 & x_2
\end{pmatrix}$, $\hat{L} = \begin{pmatrix}
\lambda_1 & 0 \\
0 & \lambda_2
\end{pmatrix}$, $\hat{R} = \begin{pmatrix}
r_1 & 0 \\
0 & r_2
\end{pmatrix} \equiv \begin{pmatrix}
\beta_1-\mu_1 & 0 \\
0 & \beta_2-\mu_2
\end{pmatrix}$, $\hat{G} = \begin{pmatrix}
g_{11}/\lambda_1 & g_{12}/\lambda_1 \\
g_{21}/\lambda_2 & g_{22}/\lambda_2
\end{pmatrix}$, and $\hat{E} = \begin{pmatrix}
e_{11}/r_1 & e_{12}/r_1 \\
e_{21}/r_2 & e_{22}/r_2
\end{pmatrix}$.

In many experimentally relevant systems, such as communities of microorganisms and cells, the timescale of production, diffusion, and degradation of secreted factors is on the order of minutes \cite{Belle2006}, whereas cell division and death occurs over hours \cite{Powell1956,Lenski1991}, and the dynamics of the turnover of the secreted factors can be assumed to adiabatically reach a steady state $\vec{t^*}$ given by $\vec{t}^* = \hat{G} \vec{x}$ \cite{Posfai2017,Assaf2016,Chotibut2017a}. %$\vec{t}^* = \hat{G}\cdot \vec{x}$
In this approximation the dynamical equations for the species number reduce to
\begin{equation}
%\dot{\vec{x}} = \hat{R}\cdot\hat{X} \left( \vec{1} - (\hat{E}\cdot\hat{G})\cdot\vec{x} \right).
\dot{\vec{x}} = \hat{R}\hat{X} \left( \vec{1} - (\hat{E}\hat{G})\vec{x} \right).
\end{equation}\label{eq-xdot-adiabatic}
Written explicitly, this becomes the familiar generalized two-species competitive Lotka-Volterra system \cite{Chotibut2015,MacArthur1970,Dobrinevski2012,Constable2015,Bomze1983,Levin1970,Czuppon2017,Young2018}:
\begin{align}
\dot{x}_1 &= r_1 x_1 \left( 1 - \frac{x_1 + a_{12} x_2}{K_1} \right) \notag \\
\dot{x}_2 &= r_2 x_2 \left( 1 - \frac{a_{21} x_1 + x_2}{K_2} \right), \label{mean-field-eqns}
\end{align}
where $\frac{1}{K_i} = \frac{e_{ii} g_{ii}}{r_i \lambda_i} + \frac{e_{ij} g_{ji}}{r_i \lambda_j}$ and $\frac{a_{ij}}{K_i} = \frac{e_{ii} g_{ij}}{r_i \lambda_i} + \frac{e_{ij} g_{jj}}{r_i \lambda_j}$. %$r_i=\beta_i-\mu_i$,
The turnover rates $r_i$ set the timescales of the birth and death for each species, and $K_i$ are known as the carrying capacities. The interaction parameters $a_{ij}$  provide a mathematical representation of the intuitive notion of the niche overlap between the species \cite{MacArthur1967,Abrams1980,Schoener1985,Chesson2008}. When $a_{ij}=0$, species $j$ does not affect the species $i$, and they occupy separate ecological niches. At the other limit, $a_{ij}=1$, the species $j$ compete just as strongly with species $i$ as species $i$ does within itself, and both species occupy same niche. We refer to the $a_{ij}$ as the niche overlap parameters.

%This simple model illustrates the general principle described in the previous section. If each toxin affects both species in the same way, so that $e_{11}=e_{12}\equiv e_1$ and $e_{21}=e_{22}\equiv e_2$ equations (\ref{eq-xi}) and (\ref{eq-fj} can be rewritten as
%\begin{align}\label{eq-x-tox}
% \dot{x}_1 &= r_1x_1(1 - e_{1}t) \\
% \dot{x}_2 &= r_2(1 - e_{2}t)\\
% \dot{t} &= (g_{11}+g_{21}) x_1 + (g_{12}+g_{22})x_2 - t,
%\end{align}
%where $t=t_1+t_2$, so that the toxins act as effectively a single toxin of a combined concentration $t$.
%In this case, the equations for $\dot{x}_1 $ and $\dot{x}_2$ cannot be simultaneously satisfied if $e_1\neq e_2$, and the only solution is either $x_1=0$ or $x_2=0$. This corresponds to the classical notion of a niche of the competitive exclusion principle as defined by one limiting faction, and the system cannot sustain more species that niches/factors [REVISE]. Only in the degenerate case of complete niche overlap, $e_1=e_2\equiv e$ whereby not only the toxins but also the species are functionally identical, the system allows multiple solutions with $t^*=1/e$ and the species numbers lying on the line $(g_{11}+g_{21}) x_1 + (g_{12}+g_{22})x_2 - t^*$. [POLISH AND REVISE].
%%%%%%%%%
%[MATTHEW: THIS paragraph IS SOMEHWAT JUMBLED AND IS DISCONNECTED FROM THE PREVIOUS ONE. GIVE IT ONE MORE GO: rearranging the sentences will go a long way.]The solutions to equation (\ref{xdot-tdot-eqn}) are that either one (or both) of the species is zero or else $\vec{x}^* = (E G)^{-1}\vec{1}$.
%Complete niche overlap is when $(E G)$ is singular/non-invertible/$(E G)^{-1}$ does not exist/$|E G|=0$; then either one of the species is excluded or the degeneracy condition occurs.
%Any 2D matrix can be written as $\hat{M}=\begin{pmatrix}
%\alpha_m   & \alpha_m\beta_m \\
%\alpha_m\gamma_m & \alpha_m\beta_m\gamma_m
%\end{pmatrix}$ and is singular when $\gamma_m=1$.
%This situation is most obvious when $|\hat{E}|=0$/$\hat{E}$ is singular: we can then write an effective composite toxin $t_1 + \beta_e t_2$, with equation (\ref{eq-x-tox}) becoming
%\begin{align*}
% \dot{x}_1 &= r_1 x_1\big(1 -          e_{11}\left( t_1 + \beta_e t_2 \right) \big) \\
% \dot{x}_2 &= r_2 x_2\big(1 - \gamma_e e_{11}\left( t_1 + \beta_e t_2 \right) \big).
%\end{align*}
%With $\gamma_e\neq 1$ this corresponds to the classic notion of two species and only one limiting factor. The two equations cannot be simultaneously satisfied and either $x_1=0$ or $x_2=0$. This is exclusion of a species, though as will be shown below there are other, non-singular cases which result in competitive exclusion.
%In the degenerate case of $\gamma_e=1$ both the species and the toxins are functionally identical: the system allows multiple solutions, along the line defined by $1=e_{11}\left( t_1^* + \beta_e t_2^* \right)$ and $\vec{x}^*=\hat{G}^{-1}\vec{t}^*$.
%In subsequent sections we shall refer to this line as the Moran line.
%$|\hat{G}|=0$ is the other situation describing complete niche overlap. The Moran line appears if $e_{11}+\gamma_ge_{12}=e_{21}+\gamma_ge_{22}$, otherwise there is exclusion of a species. [[could remove this line]]
%
%%%%%%%%%%
%%More generally, mathematically the same situation occurs  when $e_{11}=\gamma e_{12}$ and $e_{21}=\gamma e_{22}$, where $\gamma$ is an arbitrary constant. 
%%In this case, the two factors as effectively a single one with a combined concentration $t_1+\gamma t_2$ [PLS DOUBLE CHECK]. In the LV formulation, both this cases correspond to a degeneracy of the matrix $\hat{E} \hat{G}$ with $a_{12}=a_{21}$. %$\hat{E}\cdot \hat{G}$ with $a_{12}=a_{21}$
%%However, these special examples are only a subset of parameter values that result in a competitive exclusion of one species by the other, that can occur also in a non-degenerate case of two distinct toxins, where the matrix $\hat{E} \hat{G}$ is non-degenerate, as discussed in the next section. %$\hat{E}\cdot \hat{G}$
%%%%%%%%%%
%
%These derivations provide a rigorous definitions of the niche overlap. In the next two sections, we study how the niche overlap affects the stability of the species coexistence in deterministic and stochastic cases. [[rigor is questionable; maybe clear definitions/examples of niche overlap]]
The number of deterministically viable species is typically constrained by the number of limiting factors \cite{Armstrong1980}, as described in the previous section. 
Namely, if both matrices $\hat{E}$ and $ \hat{G}$ are non-singular and invertible, the solutions to Equation (\ref{xdot-tdot-eqn}) are that one (or both) of the species is zero or else $\vec{x}^* = (E G)^{-1}\vec{1}$. 
The latter solution corresponds to the coexistence of the two species.

When the matrix $(\hat{E}\hat{G})$ is singular ($a_{12}a_{21}=1$), the coexistence fixed point $\vec{x}^* = (E G)^{-1}\vec{1}$ does not exist, and the Equations (\ref{xdot-tdot-eqn}) are satisfied only if the population of one (or both) of the species is zero. %$(\hat{E}\cdot\hat{G})$
Biologically, this condition corresponds to the complete niche overlap between two species, whereby only one species can survive in the niche. 
(Of note, exclusion of one species by the other can also occur in non-singular cases, as discussed in the next section.) 
Nevertheless, even in the complete niche overlap case, multiple species can deterministically coexist within one niche if the matrix $(\hat{E}\hat{G})$ possesses a further degeneracy, $K_1/K_2=a_{12}=1/a_{21}$, corresponding to an additional symmetry in the interactions of the species with the constraining factors, as illustrated in the next paragraph. %$(\hat{E}\cdot\hat{G})$

These mathematical notions can be understood in a biologically illustrative example, when the matrix $\hat{E}$ is singular, so that $\det(\hat{E})=0$. Any singular $2\times 2$ real matrix can be written in the general form  $\hat{E}=\begin{pmatrix}
\alpha   & \alpha\beta \\
%\alpha\gamma & \alpha\beta\gamma\delta
\alpha\gamma & \alpha\beta\gamma
\end{pmatrix},$
where $\alpha$, $\beta$ and $\gamma$ are arbitrary real numbers \cite{Larson2016}. In this case Equation (\ref{eq-x-tox}) becomes
\begin{align}
\dot{x}_1 &= r_1 x_1\big(1 -        \alpha\left( t_1 + \beta t_2 \right) \big) \notag \\
\dot{x}_2 &= r_2 x_2\big(1 - \gamma \alpha\left( t_1 + \beta t_2 \right) \big),
\label{eq-xdot-niche-overlap}
\end{align}
so that both secreted factors effectively act as one factor with concentration  $t\equiv t_1 + \beta t_2$. With $\gamma\neq 1$ this corresponds to the classic notion of two species and only one limiting factor. The two equations cannot be simultaneously satisfied and the only solution of Equations (\ref{eq-xdot-niche-overlap}) is either $x_1=0$ or $x_2=0$ (or both). This is one example of competitive exclusion due to competition within a single niche.
Finally, when $\gamma=1$ (corresponding to  $a_{12}=1/a_{21}=K_1/K_2$), both the species and the secreted factors are functionally identical, and the Equations (\ref{eq-xdot-niche-overlap}) allow multiple solutions lying on the line in phase space defined by $\vec{x}^*=\hat{G}^{-1}\vec{t}^*$  and $1=\alpha\left( t_1^* + \beta t_2^* \right)$ \cite{McGehee1977a,Constable2015}; in this case many different mixtures of the two species can be deterministically stable, depending on the initial conditions. However, as discussed in the next section, this line of fixed points is unstable with respect to perturbations along the line, and stochastic effects become important. These derivations above provide a mathematical definition and a biological illustration of the niche overlap between two interacting species, and can be extended to a general case of $N$ species interacting via $M$ factors, as shown in the Supplementary Information. 
In the next two sections, I study how the niche overlap affects the stability of the species coexistence in deterministic and stochastic cases.


\section{Deterministic stability of the Lotka-Volterra model}
\begin{figure}[h]
	\centering
	\begin{minipage}{0.44\linewidth}
		\centering
		\includegraphics[width=1.0\textwidth]{{a-a-graph7}}
	\end{minipage}
	\begin{minipage}{0.55\linewidth}
		\centering
		\includegraphics[width=1.0\textwidth]{phasespace-graphic-73.jpg}
	\end{minipage}
	\caption{\emph{Left: stability phase diagram of the coexistence fixed point for $K_1=K_2=K$.} The coexistence fixed point $C=\left(\frac{K_1-a_{12} K_2}{1-a_{12}a_{21}},\frac{K_2-a_{21} K_1}{1-a_{12}a_{21}}\right)$ is stable in the green region and unstable in the blue region; in the white regions it is non-biological. Colored dots indicate the parameter range studied in the paper. The numbered regions correspond to different biological different regimes; see text.
	%Regions 4-6 correspond to competitive exclusion, with only single species fixed point $A$ or $B$ being stable (or both, in the bistable regime 5). In region 7 the populations experience unbounded growth.
	For the degenerate case $a_{12}=a_{21}=1$, indicated by the red dot, the coexistence fixed point is replaced by a line of marginal stability, shown in the Right Panel.
	\emph{Right: phase space of the coupled logistic model.} Colored dots show $C$ at the indicated values of the niche overlap $a$. The fixed point is stable for $a<1$. At $a=0$ the two species evolve independently. As $a$ increases, the deterministically stable fixed point moves toward the origin. At $a=1$ the fixed point degenerates into a line of marginally stable fixed points, corresponding to the Moran model. The dashed lines illustrate the deterministic flow of the system: black is for $a=0.5$, and orange for $a=1.2$. The zoom inset illustrates the stochastic transitions between the discrete states of the system. Fixation occurs when the system reaches either of the axes. See text for details.
	} \label{phasespace}
\end{figure}

In this section, I examine the behavior of the deterministic Equations (\ref{mean-field-eqns}), which have four fixed points:
\begin{equation}
O = (0,0) \quad A = (0,K_2) \quad B = (K_1,0) \quad C = (\frac{K_1-a_{12} K_2}{1-a_{12}a_{21}},\frac{K_2-a_{21} K_1}{1-a_{12}a_{21}}). %or use hspace
\end{equation}
The origin $O$ is the fixed point corresponding to both species being extinct, and is unstable with positive eigenvalues equal to $r_1$ and $r_2$ along the corresponding on-axis eigendirections. 
The single species fixed points $A$ and $B$ are stable on-axis (with eigenvalues $-r_1$ and $-r_2$, respectively), but are unstable with respect to invasion if point $C$ is stable, reflected in the positive second eigenvalue equal to $r_2(1-a_{21}K_1/K_2)$ and $r_1(1-a_{12}K_2/K_1)$, respectively. 
Fixed point $C$ corresponds to the coexistence of the two species and is stable in the green shaded region in the left panel of figure \ref{phasespace}, which shows the stability diagram of the system for $K_1=K_2$. \cite{Neuhauser1999,Cox2010,Chotibut2015}. %NTS:::could/should also include similar diagrams for broken symmetry

The different regions of the phase space in Figure \ref{phasespace} have different biological interpretations \cite{May2001,Abrams1977}. 
Parasitism, or predation/antagonism, occurs in regions 2 and 6 of $(a_{12}, a_{21})$ space, where $a_{12}a_{21}<0$, with one species gaining from a loss of the other. 
In the strong parasitism regime (region 6), where the positive $a_{ij}$ is greater than one, the parasite/predator drives the prey to extinction deterministically, and the only stable point is the predator's fixed point ($A$ or $B$). 
Conversely, weak parasitism (region 2) allows coexistence of both species despite the detriment of one to the benefit of the other \cite{May2001,Chotibut2015}. 
%NTS:::could easily expand this paragraph to five

The regions with both $a_{ij}<0$ correspond to mutualistic/symbiotic interactions between the species \cite{Neuhauser1999,Cox2010,Chotibut2015,May2001}. 
Weak mutualism (region 3) is mathematically similar to weak competition in that it results in stable coexistence. 
Strong mutualism (region 7) results in population explosion. 
Detailed study of this regime lies outside of the scope of the present work (but see \cite{Meerson2008}).

The quadrant with both $a_{12}>0$ and $a_{21}>0$ corresponds to the competition regime. 
At strong competition with either $a_{12}$ or $a_{21}$ greater than one (regions 4 and 5 in the left panel in Figure \ref{phasespace}), either one of the species deterministically outcompetes the other (region 5) or the system possesses two single-species stable fixed points $A$ and $B$ with separate basins of attraction (region 4). 
The complete niche overlap regime of the underlying model of Equations (\ref{xdot-tdot-eqn}) and defined by $\det[\hat{E}\hat{G}]=0$ is contained within region 4, and is given by the line $a_{12}a_{21}=1$. 
These regimes correspond to the classical competitive exclusion theory, together with the strong parasitism case (region 6). %NTS:::could be elaborated
By contrast, weak competition (region 1) where both $0<a_{ij}<1$ results in the stable coexistence at the mixed point $C$. 
In the special case $a_{12}=a_{21}=1$ (shown by the red dot) the stable fixed point degenerates into a neutral line of stable points, defined by $x_2 = K - x_1$, as shown in the right panel of Figure \ref{phasespace}. 
Each point on the line is stable with respect to perturbations off line, but any perturbations along the line are not restored to their unperturbed position \cite{McGehee1977a,Case1979}. 
This line correspond to the singular case, discussed in the previous section, where the two species are functionally identical with respect to the action of the secreted factors (\emph{eg.} $e_{11}/r_1=e_{12}/r_1$ and $e_{22}/r_2=e_{21}/r_2$ in Equations (\ref{xdot-tdot-eqn})). 
The stochastic dynamics along this line correspond to the classical Moran model as discussed below, and in the following I refer to this line as the Moran line.

The right panel of Figure \ref{phasespace} shows the phase portrait of the system, in the symmetric case of $ K_1 = K_2\equiv K$, $r_1 = r_2\equiv r$, and $a_{12}=a_{21}\equiv a$, where neither of the species has an explicit fitness advantage. 
This equality of the two species, also known as neutrality, serves as a null model against which systems with explicit fitness differences can be compared. 
In this thesis, I focus on species coexistence in the weak competition regime, finding the scaling of the mean time to fixation due to stochasticity. %as niche overlap $a$ is varied. 
The asymmetric case is also treated, with results qualitatively similar to the symmetric case. 
%NTS:::either here or in introduction (Ch0) need to be clear about what is meant by neutral, what is meant by symmetric

%The color-coded dots in the right panel of Figure \ref{phasespace} show the locations of the coexistence fixed point for the indicated values of $a$. The fixed point is stable for $|a|<1$; for $|a|>1$ the model transitions into the strong competition regime and the coexistence point becomes unstable. For $a=0$ the species are independent of each other.
%In the opposite limit of complete niche overlap, $a=1$, the fixed point undergoes a bifurcation into a line of semi-stable fixed points connecting points $A$ and $B$ defined by $x_2 = K - x_1$.
%This 1D manifold of marginal stability corresponds to the complete niche overlap, as discussed above, and arises because the equations describing the dynamics of $x_1$ and $x_2$ are identical when $a=1$.


%\section{Effects of Stochasticity}
\section{The stochastic Lotka-Volterra model}
Stochasticity naturally arises in the dynamics of the system from the randomness in the birth and death times of the individuals - commonly known as the demographic noise \cite{VanKampen1992,Elgart2004a,Parker2009,Assaf2006}. 
Competitive interactions between the species can affect either the birth rates (such as competition for nutrients) or the death rates (such as toxins or metabolic waste), and in general may result in different stochastic descriptions \cite{Allen2003a,Badali2018}, as was discussed in the previous chapter. 
In this chapter, I follow others \cite{Lin2012,Gabel2013,Constable2015} in considering the case where the inter-species competition affects the death rates, so that the per capita birth and death rates $b_i$ and $d_i$ of species $i$ are:
\begin{equation}
\begin{aligned}
b_i/x_i &= r_i \\
d_i/x_i &= r_i\frac{x_i+a_{ij}x_j}{K_i}.  \label{deathrate}
\end{aligned}
\end{equation}
In terms of the previous chapter, this corresponds to choosing $\delta = 0$ and $q=0$. %EDIT:::does this want justification?
In the deterministic limit of negligible fluctuations the model recovers the mean field competitive Lotka-Volterra Equations (\ref{mean-field-eqns}) \cite{Lin2012}. 

The system is characterized by the vector of probabilities $P(s,t|s^0)$ to be in a state $s=\{x_1,x_2\}$ at time $t$, given the initial conditions $s^0=(x_1^{0},x_2^{0})$: $\vec{P}(t)\equiv\big(\dots,P(s,t|s^0),\dots \big)$ \cite{Munsky2006}. 
The forward master equation describing the time evolution of this probability distribution is \cite{VanKampen1992}
\begin{align} \label{matrix-master-eqn}
\frac{d}{dt}\vec{P}(t) = \hat{M}\vec{P}(t),
\end{align}
where $\hat{M}$ is the (semi-infinite) transition matrix. %The matrix $\hat{M}$ is sparse, with non-zero elements along the diagonal, $\hat{M}_{s,s}=-b_1(s)-b_2(s)-d_1(s)-d_2(s)$, and $\pm 1$ off the diagonal, $\hat{M}_{s,s+1}=d_2(s+1)$ and $\hat{M}_{s+1,s}=b_2(s)$.
I do not include the absorbing states in my transition matrix, and the master equation \ref{matrix-master-eqn} as written does not preserve probability, as some of it leaks into fixation. 

Because the approximate analytical and semi-analytical solutions of the master Equation (\ref{matrix-master-eqn}) often do not provide correct scaling in all regimes (\cite{Doering2005,Assaf2016,Badali2018}; see also the previous chapter), I analyse the master equation numerically in order to recover both the exponential and polynomial aspects of the mean time to fixation. 
To enable numerical manipulations, I introduce a reflecting boundary condition at a cutoff population size $C_K>K$ for both species to make the transition matrix finite \cite{Munsky2006,Cao2016} and enumerate the states of the system with a single index \cite{Munsky2006} via the mapping of the two species populations $(x_1,x_2)$ to state $s$ as
\begin{equation}
s(x_1,x_2) = (x_1-1)C_K+x_2-1,
\end{equation}
where $s$ serves as the index for our concatenated probability vector, uniquely enumerating all the states. 
In this representation, the non-zero elements of the sparse matrix $\hat{M}$ are $\hat{M}_{s,s}=-b_1(s)-b_2(s)-d_1(s)-d_2(s)$ along the diagonal, $\hat{M}_{s,s+1}=d_2(s+1)$ and $\hat{M}_{s+1,s}=b_2(s)$ at $\pm 1$ off the diagonal, and $\hat{M}_{s,s+C_K}=d_1(s+C_K)$ and $\hat{M}_{s+C_K,s}=b_1(s)$ off-diagonal at $\pm C_K$. 
Some diagonal elements are modified to ensure the reflecting boundary at $x_i=C_K$. 
%I have found that the choice $C_K=5K$ is more than sufficient to calculate the mean fixation times to at least three significant digits of accuracy.


%\section{Comparison with the Gillespie algorithm}% and choice of cutoff parameter}
%NTS:::Anton thinks I should remove and/or revise this; I did not address his comments in the first round

Numerical results obtained from the Gillespie algorithm are accurate, assuming a sufficient number are averaged over \cite{Gillespie1977}. 
Unfortunately even for a system size as small as $K=20$ some of the simulations took over ten million steps before fixating. 
A tau-leaping implementation helps \cite{Cao2006}, but the problem remains that this fixation is a slow process and simulations of large $K$ will be prohibitively long. 
As shown above, the distribution of fixation times is roughly exponential. 
Any simulations that do not finish will be from the tail end of the distribution but will have the largest contribution to the mean time, hence cannot be ignored. 
%Despite being rare, these long time trajectories have a significant contribution to the mean time, by virtue of their magnitude. 

Inverting the truncated transition matrix, as has been done in this chapter, is a much faster computational problem, and is hindered by insufficient RAM rather than interminable runtimes. 
Changing the cutoff means that the solution can be arbitrarily precise. 
In the left panel of figure \ref{lntauvK}, the direct solution from inverting the truncated transition matrix compares favourably with the Gillespie simulations. 

%\section*{Parameter Choices}
To ensure accuracy of the mean times to 0.1\% or better I choose $C_K=5K$. 
This is largely excessive and even $C_K=2K$ is sufficient for all but the smallest carrying capacities, for which it is least important to be accurate. 
The sparse matrix LU decomposition algorithm is implemented with the C++ library Eigen \cite{eigenweb}. 

\iffalse
\begin{figure}[ht]
	\centering
	\includegraphics[width=0.7\textwidth]{coupled-logistic-data-vs-Gillespie.pdf}
	\caption{\emph{Directly solving the (truncated) master equation agrees with Gillespie simulations.} Solid lines come from directly solving the backwards master equation by inverting the transition matrix, after a cutoff has been applied to the matrix to make it finite. Dashed lines are each an average of a hundred realizations of the stochastic process, as simulated using the Gillespie algorithm. }
	\label{Gillespie}
\end{figure}
\begin{figure}[ht]
	\centering
	\includegraphics[width=0.95\textwidth]{{coupled-logistic-data}}
	\caption{\emph{Dependence of the fixation time on carrying capacity and niche overlap.}
		%Fixation time as a function of carrying capacity $K$ for different values of niche overlap $a$.
		The lowest line, $a=1$, recovers the Moran model results with the fixation time algebraically dependent on $K$ for $K\gg 1$. For all other values of $a$, the fixation time is exponential in $K$ for $K\gg 1$.
	} \label{lntauvK}
\end{figure}
\fi
\begin{figure}[h]
	\centering
	\begin{minipage}{0.49\linewidth}
		\centering
		\includegraphics[width=1.0\linewidth]{coupled-logistic-data-vs-Gillespie.pdf}
	\end{minipage}
	\begin{minipage}{0.49\linewidth}
		\centering
		\includegraphics[width=1.0\linewidth]{coupled-logistic-data.pdf}
	\end{minipage}
	\caption{\emph{Dependence of the fixation time on carrying capacity and niche overlap.}
		\emph{Left:} Dotted lines come from directly solving the backwards master equation by inverting the transition matrix as per equation \ref{explicit-tau}, after a cutoff has been applied to the matrix to make it finite. Dashed lines connecting crosses are each an average of a hundred realizations of the stochastic process, as simulated using the Gillespie algorithm with tau-leaping \cite{Gillespie1977,Cao2006}. The simulations and direct solution are in good agreement, as one would expect. 
		\emph{Right:} The same direct solution data as in the left panel are extended to larger carrying capacities. The lowest line, $a=1$, recovers the Moran model results in solid green with the fixation time algebraically dependent on $K$ for $K\gg 1$. For all other values of $a$, the fixation time is exponential in $K$ for $K\gg 1$. At $a=0$ the systems acts as two independent stochastic logistic systems, and matches that limit as shown with the solid purple line. 
	} \label{lntauvK}
\end{figure}


\section{Mean fixation time in the classical Moran model}
%NTS:::could move this to the appendix
%The Moran model \cite{Moran1962} is similar to the Wright-Fisher model \cite{Wright,Fisher} in the limit of large $K$.
Here I derive the mean fixation time for the Moran model \cite{Moran1962}, which will be used later as a limiting case of the Lotka-Volterra dynamics. 
Previous authors have already shown that this is the limit \cite{Lin2012,Constable2015,Chotibut2015}, and the fixation time for the Moran model is already known \cite{Moran1962}. I only include it here for completeness. 
The Wright-Fisher model gives similar results for large $K$, but is less intuitable, dealing as it does with a whole generation at a time, rather than one birth and one death. %pedagogical \cite{Wright1931}. 

In the classical Moran model, at each time step, an individual is chosen at random to reproduce. In order to keep the population constant, another one is chosen at random to die. %It is a discrete time model, hence instead of rates it has probabilities.
The probabilities that the number of individuals of species 1 increases or decreases by one  in one time step are \cite{Moran1962}:
\begin{equation}
b_{M}(n) = f(1-f) = (1-f)f = d_{M}(n) = \frac{n}{K}\left(1-\frac{n}{K}\right) = \frac{1}{K^2}n(K-n),
\label{eq-supp-moran-probs}
\end{equation}
where $n$ is the number and $f$ is the fraction of species 1 in the system (of total system size $K$). 
%In the classical Moran model time is discrete, but for ease of communication we will use continuous time. 
The mean fixation time, $\tau(n)$, starting from some initial number $n$ of species 1 is described by the following backward master equation \cite{Nisbet1982}:
\begin{equation*}
\tau(n) = \Delta t + d_{M}(n)\tau(n-1) + \left(1-b_{M}(n)-d_{M}(n)\right)\tau(n) + b_{M}(n)\tau(n+1),
\end{equation*}
where $\Delta t$ is the time step. 
Substituting the values of the `birth' and `death' probabilities of species 1 from equation (\ref{eq-supp-moran-probs}) we get
\begin{equation*}
\tau(n+1) - 2\tau(n) + \tau(n-1) = -\frac{\Delta t}{b_{M}(n)} = -\Delta t\frac{K^2}{n(K-n)}.
\end{equation*}
At $K\gg 1$, the Kramers-Moyal expansion in $1/K$ results in
\begin{equation*}
\frac{\partial^2\tau}{\partial n^2} = -\Delta t\,K\left(\frac{1}{n}+\frac{1}{K-n}\right).
\end{equation*}
Integrating, using the boundary conditions  $\tau(0) = \tau(K)=0$, gives
\begin{equation}
\tau(n) = -\Delta t\,K^2\left(\frac{n}{K}\ln\left(\frac{n}{K}\right)+\frac{K-n}{K}\ln\left(\frac{K-n}{K}\right)\right).
\end{equation}\label{Morantime}
%\begin{figure}%[ht]
%	\centering
%	%\includegraphics[width=0.7\textwidth]{moran-comparison-64-3}
%	\includegraphics[width=0.7\textwidth]{morantimespicturename.png}
%	\caption{\emph{The coupled logistic model agrees with the Moran model in the limit of complete niche overlap, $a=1$.}  Fixation time varies with initial fraction of the species in the population. The fixation time for the Moran model is in red and the coupled logistic model for $a=1$ is in black. The population size of the Moran model is set equal to the carrying capacity $K=64$ of the corresponding coupled logistic model. 
%		%For comparison, the dashed green line is the same coupled logistic model but with $a=0.9$. 
%	} \label{ICfig}
%\end{figure}%NTS:::THIS DOES NOT ACCOUNT FOR THE NEW DELTA T = 3/K BUSINESS - NEEDS TO BE RECODED AND CORRECTED

For the initial condition analogous to the coexistence point, $n = K/2$, this gives
\begin{equation*}
\tau = \Delta t\,K^2\ln\left(2\right).
\end{equation*}
Recall that the Moran model counts one time unit $\Delta t$ every birth and death pair of events. 
The correspondence between the Moran model and the related Wright-Fisher model occurs when the Moran model has undergone a number of births and deaths equal to the (fixed) population size of Wright-Fisher, often called the generation time \cite{um}. 
The time scale regarded is important. 
Similarly, for comparison between Moran and the coupled logistic model, one needs to match the time scales. 
%Given that the Moran model time step corresponds to one birth and one death event, I make the comparison with the estimate 
%\begin{equation}
%\Delta t \approx \frac{1}{\big(b_1\left(x_1,K-x_1\right)+b_2\left(x_1,K-x_1\right)\big)/2+\big(d_1\left(x_1,K-x_1\right)+d_2\left(x_1,K-x_1\right)\big)/2}
%\end{equation}
%% \Delta t \approx \frac{2}{b_1(K/2,K/2)+b_2(K/2,K/2)+d_1(K/2,K/2)+d_2(K/2,K/2)}.
%where $b_i$ and $d_i$ are the birth and death rates of the coupled logistic model. 
%That is, the average time of one Moran time step is the sum of the average of one birth and one death. 
First, note that the birth and death events can be treated as independent under the assumption that a single birth or death does not change the rates significantly, an assumption which is valid far from the axes. 
Then the probability of the next birth event happening around time $t$ is $f(t)dt = b\,e^{-b\,t}dt$, and similarly $g(t)dt = d\,e^{-d\,t}dt$. 
Then define the probability of the birth happening by \emph{by} time $t$ is $F(t) = \int_0^t f(t') dt'$, and similarly $G(t) = 1-e^{-d\,t}$. 
Assuming independence, a birth and a death event have happened by time $t$ with probability $F(t)G(t)$, and the distribution of this time is given by $\partial_t[F(t)G(t)]$. 
The average time of a birth and death is then
\begin{align*}
 \Delta t &= \int_{0}^{\infty} t \partial_t[FG] dt = \int_{0}^{\infty} t \partial_t[FG] = \int_{0}^{\infty} t \left(f(t) + g(t) - (b+d)e^{-(b+d)t}\right) \notag \\
          &= \frac{1}{b} + \frac{1}{d} - \frac{1}{b+d} = \frac{b^2 + b d + d^2}{b (b+d) d}.
\end{align*}
In principle this should be averaged over all combinations of the two species giving birth and dying, weighted by the probabilities of each pairing. 
It should also account for the probability of being at a particular state, as the state affects the rates. 
To simplify this I provide a lower bound by assuming that most of the time is spent near the initial state for the Moran limit, $\left(K/2,K/2\right)$, such that $b_i\left(K/2,K/2\right)=d_i\left(K/2,K/2\right)=K/2$. 
This gives% $\Delta t = \frac{3}{K}
\begin{equation}
\Delta t = \frac{3}{2}\frac{1}{b} = \frac{3}{2}\frac{1}{K/2}  = \frac{3}{K}
\end{equation}
%Since the coupled logistic model spends most of its time near the Moran line $x_1+x_2=K$ I assume that on average the Moran time step should be
%%Since $b_i\left(x_1,K-x_1\right)=d_i\left(x_1,K-x_1\right)=K/2$ we get $\Delta t \approx 1/K$ and therefore
%Since the initial conditions have equal populations of each species, and since $b_i\left(K/2,K/2\right)=d_i\left(K/2,K/2\right)=K/2$, I get $\Delta t \approx 1/K$.
and therefore
\begin{equation}
\tau = 3\ln(2)\, K. \label{morantime}
\end{equation}
The fixation time of the Moran model agrees well with the results of the coupled logistic model for complete niche overlap, as shown in figure \ref{ICfig}. 
%the left panel of figure \ref{etimedistr}. 
%NTS:::reference soft manifold stuff

%In the deterministic model the WFM line arises at complete niche overlap.
%We claim that there is an agreement between the coupled logistic model in this limit, and the WFM model results, and show that the mean fixation time has the same scaling with system size $K$ for both of them.
%%, but this does not necessitate an agreement between the coupled logistic model and that of WFM.
%To further confirm the comparison, we calculate the mean time to fixation in the coupled logistic model's $a=1$ limit as the time varies with the initial conditions.
%Calculations were started on the WFM line at various relative abundances $f$ of species 1, to compare with Equation (\ref{Morantime}).
%Figure \ref{ICfig} shows good agreement between the WFM model and the coupled logistic model.


\iffalse
\section{Exact and approximate mean extinction time for a single stochastic logistic model} %NTS:::MOVE TO PREVIOUS CHAPTER!!!
A one dimensional logistic process has birth rate $b(n)=r\,n$ and death rate $d(n)=r\,n\frac{n}{K}$.
The mean extinction time $\tau[n_0]$ depends on the initial state $n_0$. The  mean extinction times for different initial state $n_0$ obey the usual backward recursion relation \cite{Nisbet1982}
\begin{equation}\label{tau1}
\tau[n_0] = \frac{1}{b(n_0)+d(n_0)}
+ \frac{b(n_0)}{b(n_0)+d(n_0)}\tau[n_0+1]
+ \frac{d(n_0)}{b(n_0)+d(n_0)}\tau[n_0-1].
\end{equation}
Some rearrangement and defining of terms allows the writing of the difference relation
\begin{equation}\label{tau2}
\tau[n_0+1] - \tau[n_0] = \left(\tau[1] - \sum_{i=1}^{n_0}q_i\right)S_{n_0},
\end{equation}
where
\begin{equation} \label{def-qi}
q_0 = \frac{1}{b(0)}\;\;\; q_1 = \frac{1}{d(1)},
\end{equation}
\begin{equation*}
q_i = \frac{b(i-1)\cdots b(1)}{d(i)d(i-1)\cdots d(1)} = \frac{1}{d(i)}\prod_{j=1}^{i-1}\frac{b(j)}{d(j)}, \text{  } i>1,
\end{equation*}
and
\begin{equation}
S_i = \frac{d(i)\cdots d(1)}{b(i)\cdots b(1)} = \prod_{j=1}^i \frac{d(j)}{b(j)}.
\end{equation}
%Note \cite{Nisbet1982} that extinction is certain if
%\begin{equation}
% \sum_{i=1}^{\infty}S_i = \infty.
%\end{equation}
%Similarly, if $\sum_{i=1}^{\infty}q_i=\infty$ then $\tau[1]=\infty$ and hence for any population the mean extinction time is infinite.
%Iteration of equations \ref{tau1} and \ref{tau2} gives
%\begin{equation}
% \tau[n_0] = \tau[1] + \sum_{j=1}^{n_0-1}\left(\tau[1] - \sum_{i=1}^{j}q_i\right)S_{j}.
%\end{equation}
%It can be shown that
%\begin{equation*}
% \lim_{n_0\rightarrow\infty} \left(\tau[n_0+1] - \tau[n_0]\right)/S_{n_0} = 0
%\end{equation*}
%and hence
%\begin{equation}
% \tau[1] = \sum_{i=1}^{\infty}q_i.
%\end{equation}
%Then finally we conclude that
If the process does indeed go extinct and in finite time then the extinction time can be written as follows \cite{Nisbet1982}:
\begin{equation} \label{etime-approx0}
\tau[n_0] = \sum_{i=1}^{\infty}q_i + \sum_{j=1}^{n_0-1} S_j\sum_{i=j+1}^{\infty}q_i.
\end{equation}
Evaluating this sum with $b(n)=r n$, $d(n)=rn^2/K$ and the initial condition $n_0 = K \gg 1$ with the help of Mathematica gives
\begin{equation*}
r\,\tau \simeq -\gamma - \Gamma[0,-K] - \ln[K].
\end{equation*}
which has the asymptotic limit
\begin{equation} \label{1Dlog}
r\,\tau \simeq \frac{1}{K}e^K
\end{equation}
to leading order \cite{Lande1993}.
\fi

\iffalse
\begin{figure}[h]
	\centering
	\begin{minipage}{0.49\linewidth}
		\centering
		\includegraphics[width=1.0\linewidth]{morantimespicturename.png}
	\end{minipage}
	\begin{minipage}{0.49\linewidth}
		\centering
		\includegraphics[width=1.0\linewidth]{etimedistr1D16K.png}
	\end{minipage}
	\caption{\emph{Exploration of the niche overlap limits of the coupled logistic model.}
		\emph{Left:} The coupled logistic model agrees with the Moran model in the limit of complete niche overlap, $a=1$. Fixation time varies with initial fraction of the species in the population. The fixation time for the Moran model is in red and the coupled logistic model for $a=1$ is in black. The population size of the Moran model is set equal to the carrying capacity $K=64$ of the corresponding coupled logistic model. 
		%NTS:::THIS DOES NOT ACCOUNT FOR THE NEW DELTA T = 3/K BUSINESS - NEEDS TO BE RECODED AND CORRECTED
		\emph{Right:} The extinction time distribution of a one-dimensional logistic model is dominated by a single exponential tail. The bulk of the probability density is modelled by an exponential distribution with the same mean, shown in the red dotted line.  Data are generated using using the Gillespie algorithm for $K=16$. For higher carrying capacities the assumption of exponentially distributed times becomes even more accurate. This curve informs my two-dimensional independent limit $a=0$, as the minimum of two exponential distribution is an exponential distribution. 
	} \label{etimedistr}
\end{figure}
\fi
\begin{figure}[h]
	\centering
	\includegraphics[width=0.6\linewidth]{morantimespicturename.png}
	\caption{\emph{Moran-like dynamics in the Moran limit of niche overlap in the coupled logistic model.}
	The coupled logistic model agrees with the Moran model in the limit of complete niche overlap, $a=1$. Fixation time varies with initial fraction of the species in the population. The fixation time for the Moran model is in red and the coupled logistic model for $a=1$ is in black. The population size of the Moran model is set equal to the carrying capacity $K=64$ of the corresponding coupled logistic model. 
	} \label{ICfig}
\end{figure}

\section{Fixation time of the coupled logistic model in the independent limit}
%\begin{figure}[ht]
%	\includegraphics[width=0.7\textwidth]{etimedistr1D16K.png}
%	\caption{\emph{Extinction time distribution of the logistic model is dominated by a single exponential tail.} 
%		%Distribution of the extinction times of a single logistic model. 
%		The bulk of the probability density is modelled by an exponential distribution with the same mean, shown in the red dotted line.  Data are generated using using the Gillespie algorithm for $K=16$. For higher carrying capacities the assumption of exponentially distributed times becomes even more accurate. } \label{etimedistr}
%\end{figure}

Here I calculate the mean fixation time in the independent limit of the coupled logistic model given a distribution of extinction times for a single logistic model. The fixation occurs when either of the species goes extinct. 
Denoting the probability distribution of the extinction times for either of independent species as $p(t)$ and its cumulative as $F(t)=\int_{s=0}^t p(s)ds$, the probability that \emph{either} of the species goes extinct in the time interval $[t,t+dt]$, is the probability of species 1 going extinct while species 2 has not plus the probability that species 2 goes extinct while species 1 has not, since these are the two possibilities. 
That is,
\begin{equation}
p_{min}(t)dt = \bigg(p(t)\left(1-F(t)\right)+\left(1-F(t)\right)p(t)\bigg)dt = 2p(t)\left(1-F(t)\right)dt.
\end{equation}
The mean time to fixation $\langle t\rangle$ is 
\begin{equation}
\langle t\rangle = \int_0^\infty dt\, t\, p_{min}(t).
\end{equation}
%\begin{figure}%[ht]
%\centering
%\includegraphics[width=0.7\textwidth]{etimedistr1D16K.png}
%\caption{\emph{Extinction time distribution dominated by a single exponential tail.} Distribution of the extinction times of a single logistic model. The bulk of the probability density is modelled by an exponential distribution with the same mean.  Data are generated using using the Gillespie algorithm for $K=16$. For higher carrying capacities the assumption of exponentially distributed times becomes even more accurate. }
%\end{figure} \label{etimedistr} %The inset is the same plot but with a log-scaled ordinate axis.
As shown in figure \ref{etimedistr} from the previous chapter, the probability distribution of fixation times of a single species is dominated by the exponential tail. %the right panel of 
It can be approximated as
\begin{equation}
p(t) = \alpha e^{-\alpha t},\;\;\;\;  F(t) = 1 - e^{-\alpha t}
\end{equation}
with $\frac{1}{\alpha}\simeq \frac{1}{K}e^K$ from the previous section. %NTS:::from the previous chapter now
Finally, I obtain for the mean time to fixation
\begin{equation}
\langle t\rangle = \int_0^\infty dt\, t\, 2\alpha e^{-2\alpha t} = \frac{1}{2\alpha}. \label{indietime}
\end{equation}
which leads to the equation $\tau \simeq \frac{1}{2K} e^K$. 


\section{Fixation time as a function of the niche overlap}
In this section I calculate the first passage times to the extinction of one of the species and the corresponding fixation of the other, induced by demographic fluctuations, starting from an initial condition of the deterministically stable coexistence point. 
The master Equation (\ref{matrix-master-eqn}) has a formal solution obtained by the exponentiation of the matrix: $\vec{P}(t) = e^{\hat{M} t}\vec{P}(0)$. 
However, direct matrix exponentiation, as well as direct sampling of the master equation using the Gillespie algorithm \cite{Gillespie1977,Cao2006}, are impractical since the fixation time grows exponentially with the system size. %; nevertheless, I used Gillespie tau-leaping simulations to verify my results up to moderate system size, as outlined above. 
However, the moments of the first passage times can be calculated directly without explicitly solving the master equation \cite{Grinstead2003}. 
The mean residence time in any state $s$ during the system evolution is
\begin{equation}
\langle t(s^0)\rangle_s=\int_0^\infty dt\; P(s,t|s^0)=\int_0^\infty dt \; (e^{\hat{M}t})_{s,s^0}=-(\hat{M}^{-1})_{s,s^0}. \label{residence-time}
\end{equation}
The final equality in the previous equation is obtained integration by parts and requires that all the eigenvalues of the transition matrix $\hat{M}$ are negative, a fact that is evident by its construction: since the master equation conserves probability (which is bounded by one), none of the eigenvalues can be positive; since the steady state absorbing states have been removed, there are no zero eigenvalues. 
Thus, the mean time to fixation starting from a state $s^0$ is \cite{Iyer-Biswas2015}
\begin{equation} \label{explicit-tau}
\tau(s^0) =-\sum_s\langle t(s^0)\rangle_s=-\sum_s \left(\hat{M}^{-1}\right)_{s,s^0}.
\end{equation}
This expression can be also derived using the backward equation formalism \cite{Iyer-Biswas2015}.
The matrix inversion was performed using LU decomposition algorithm implemented with the C++ library Eigen \cite{eigenweb}, which has algorithimic complexity of the calculation scaling algebraically with $K$.
Increasing the cutoff $C_K$ enables calculation of the mean fixation times to an arbitrary accuracy.

The right panel of figure \ref{lntauvK} shows the calculated fixation times with the initial condition at the deterministically stable coexistence fixed point as a function of the carrying capacity $K$ for different values of the niche overlap $a$. 
In the limit of non-interacting species ($a=0$), each species evolves according to an independent stochastic logistic model, and the  probability distribution of the fixation times is a convolution of the extinction time distributions of a single species, which are dominated by a single exponential tail \cite{Norden1982,Hanggi1990,Ovaskainen2010}. 
Mean extinction time of a single species can be calculated exactly as in the previous chapter, and asymptotically for $K\gg 1$ it varies as $\frac{1}{K} e^K$ \cite{Lande1993} giving for the overall fixation time in the two species model  $\tau \simeq \frac{1}{2K} e^K$ as in Equation (\ref{indietime}).
This analytical limit is shown in figure \ref{lntauvK} as a solid purple line and agrees well with the numerical results of Equation (\ref{explicit-tau}). 
From the biological perspective, for sufficiently large $K$, the exponential dependence of the fixation time on $K$ implies that the fluctuations do not destroy the stable coexistence of the two species. %NTS:::ensure that this is elaborated upon elsewhere - appendix?

In the opposite limit of complete niche overlap, $a=1$, any fluctuations along the line of neutrally stable points are not restored, and the system performs diffusion-like motion that closely parallels the random walk of the classic Moran model \cite{Antal2006,Chotibut2015,Dobrinevski2012,Fisher2014,Constable2015,Lin2012,Kessler2007,Young2018}. 
The Moran model shows a relatively fast fixation time scaling algebraically with $K$ \cite{Moran1962,Lin2012}, $\tau \simeq \ln(2) K^2 \Delta t$; see Equation (\ref{morantime}). 
The fixation time predicted by the Moran model is shown in figure \ref{lntauvK} as a solid green line and shows excellent agreement with my exact result. 
%Note that the average time step $\Delta t$ in the corresponding Moran model is $\Delta t \approx 1/K$ because the mean transition time in the stochastic LV model is proportional to $1/(rK)$ close to the Moran line \cite{Chotibut2015}; see the Supplementary Information for more details. 
The relatively short fixation time in the complete niche overlap regime implies that the population can reach fixation on biologically realistic timescales. 

The exponential scaling of the fixation time with $K$ persists for incomplete niche overlap described by the intermediate values of $0<a<1$. 
However, both the exponential and the algebraic prefactor depend on the niche overlap $a$. 
The exponential scaling is expected for systems with a deterministically stable fixed point \cite{Ovaskainen2010,Assaf2016,Gabel2013,Fisher2014,Doering2005}, as indicated in \cite{Chotibut2015,Dobrinevski2012,Lin2012} using Fokker-Planck approximation and in \cite{Gabel2013} using the WKB approximation. 
However, the Fokker-Planck and WKB approximations, while providing the qualitatively correct dominant scaling, do not correctly calculate the scaling of the polynomial prefactor and the numerical value of the exponent simultaneously \cite{Kessler2007,Ovaskainen2010,Badali2018}, as was shown in the previous chapter.
For large population sizes and timescales, effective species coexistence will be typically observed experimentally whenever the fixation time has a non-zero exponential component. %, $f(a)\neq 0$. % [[need to cite that pop sizes are large?]].

\iffalse
\begin{figure}[ht]
	\centering
	\includegraphics[width=0.95\textwidth]{{functionalKa9}}
	\caption{\emph{Right: Niche overlap controls the transition from coexistence to fixation.}  Blue line: $f(a)$ from the ansatz of Equation (\ref{ansatz}) characterizes the exponential dependence of the fixation time on $K$; it  smoothly approaches zero as the niche overlap reaches its Moran line value $a=1$. Green line: $g(a)$ quantifies the scaling of the pre-exponential prefactor $K^{g(a)}$ with $K$. Yellow line: $h(a)$ is the multiplicative constant. Dashed bars represent a 95\% confidence interval. The dots at the extremes $a=0$ and $a=1$ are the expected asymptotic values. 
	} \label{ansatzplot}
\end{figure}% from equations (\ref{morantime}) and (\ref{indietime}), which varies from $g(a)=-1$ for the independent processes to $g(a)=1$ in the WFM limit
%NTS:::THIS DOES NOT ACCOUNT FOR THE NEW DELTA T = 3/K BUSINESS - NEEDS TO BE RERUN AND CORRECTED
%NTS:::from Anton, "You can't have figures that occupy the whole page" - yes but I can?!?
\fi

To quantitatively investigate the transition from the exponentially stable fixation times to the algebraic scaling in the complete niche overlap regime, I use the ansatz
\begin{equation}
\tau(a,K) = e^{h(a)}K^{g(a)}e^{f(a)K}. \label{ansatz}
\end{equation}
In the  Moran limit, $a=1$, I expect $f(1)=0$, $g(1)=1$, and $h(1)=\ln\big(\ln(2)\big)$ as follows from equation (\ref{morantime}). In the independent species limit with zero niche overlap, $a=0$, equation (\ref{indietime}) suggests $f(0)=1$, $g(0)=-1$, and $h(0)=-\ln(2)$. 
%In the  Moran limit, $a=1$, I expect $f(1)=0$, $g(1)=1$. In the independent species limit with zero niche overlap, $a=0$, I expect $f(0)=1$ and $g(0)=-1$. 
The left panel of figure \ref{ansatzplot} shows the ansatz functions $f(a)$, $g(a)$, and $h(a)$, obtained by numerical fit to the fixation times as a function of $K$ shown in Figure \ref{lntauvK}. 
The numerical results agree well with the expected approximate analytical results for $a=0$ and $a=1$ with small discrepancies attributable to the approximate nature of the limiting values. 
Notably, $f(a)$, which quantifies the exponential dependence of the fixation time on the niche overlap $a$, smoothly decays to zero at $a=1$: only when two species have complete niche overlap ($a=1$) does one expect rapid fixation dominated by the algebraic dependence on $K$. 
In all other cases the mean time until fixation is exponentially long in the system size \cite{Hanggi1990,Ovaskainen2010}. 
Even two species that occupy \emph{almost} the same niche ($a\lesssim1$) effectively coexist for $K\gg 1$, with small fluctuations around the deterministically stable fixed point. 

%NTS:::put in the Discussion?
%The exponential scaling results can be understood using the Fokker-Planck equation. 
%In the Supplementary Information we linearize the Fokker-Planck equation to get a Gaussian solution \cite{VanKampen1992}, and hence a potential for the system. 
%By analogy with Kramers' theory \cite{Hanggi1990} the extinction time should be proportional to the exponential of the well depth. 
%We find a well depth of $\Delta U = \frac{(1-a)}{2(1+a)}K$. 
%That is, Kramers' theory on the linearized system also predicts that the scaling should be exponential except for complete niche overlap. 

%When $K$ is small the exponential scaling is less relevant compared to the prefactors fit by $g(a)$ and $h(a)$. 
%That is, for some carrying capacity and niche overlap combinations the fixation time can be shorter than that of a similarly sized Moran model. 
%This is exactly what is shown in the shaded region of the inset in the right panel of Figure \ref{lntauvK}. 
%In the unshaded region, two species co-exist for long times, whereas in the shaded region the system will fixate as fast or faster than a Moran model with the same carrying capacity. 
%At larger carrying capacities this shaded region approaches the $a=1$ axis, which is a good approximation of the Moran model. 

%The exponential dependence of the escape time from the fixed point also persists in the non-neutral case, when the parameter symmetry is broken, although the results are not quite as extreme. % (see Supplementary Information). 
%Any approach in parameter space to the Moran line gives a smoothly decreasing $f$ to zero. 
%With a different asymmetry the co-existence point approaches one of the axial fixed points and the exponential scaling again goes to zero. 
%These asymmetries are explored in the Supplementary Information. 

%???!!!Some implications of the above results are addressed in the Discussion section below.

\begin{figure}[h]
	\centering
	\begin{minipage}{0.59\linewidth}
		\centering
		\includegraphics[width=1.0\linewidth]{functionalKa9}
	\end{minipage}
	\begin{minipage}{0.39\linewidth}
		\centering
		\includegraphics[width=1.0\linewidth]{coexist-vs-fixate.pdf}
	\end{minipage}
	\caption{\emph{Niche overlap controls the transition from coexistence to fixation.}
		\emph{Left:} Blue line: $f(a)$ from the ansatz of Equation (\ref{ansatz}) characterizes the exponential dependence of the fixation time on $K$; it  smoothly approaches zero as the niche overlap reaches its Moran line value $a=1$. Green line: $g(a)$ quantifies the scaling of the pre-exponential prefactor $K^{g(a)}$ with $K$. Yellow line: $h(a)$ is the multiplicative constant. Dashed bars represent a 95\% confidence interval. The dots at the extremes $a=0$ and $a=1$ are the expected asymptotic values from equations (\ref{morantime}) and (\ref{indietime}), which varies from $g(a)=-1$ for the independent processes to $g(a)=1$ in the Moran limit. 
		%NTS:::THIS DOES NOT ACCOUNT FOR THE NEW DELTA T = 3/K BUSINESS - NEEDS TO BE RECODED AND CORRECTED
		\emph{Right:} In part of the parameter space, fixation is always fast. The white area shows where two species are expected to effectively coexist, while the black shading identifies the regime where fixation is faster than a similarly-sized Moran model. Fixation is estimated by extrapolating the ansatz parameter fits to the $a,K$ parameter space. %NTS:::THIS DOES NOT ACCOUNT FOR THE NEW DELTA T = 3/K BUSINESS - NEEDS TO BE rerun AND CORRECTED
	} \label{ansatzplot}
\end{figure}

\section{Co-existence versus fixation in parameter space}
%\begin{figure}[ht]
%	\centering
%	\includegraphics[width=0.45\textwidth]{coexist-vs-fixate.pdf}
%	\caption{\emph{Parameter space in which fixation is fast.} The white area shows where two species are expected to effectively coexist, while the black shading identifies the regime where fixation is faster than a similar Moran model. Fixation is estimated by extrapolating the ansatz parameter fits to the $a,K$ parameter space. }
%	\label{coexistvsfixate}
%\end{figure}%NTS:::THIS DOES NOT ACCOUNT FOR THE NEW DELTA T = 3/K BUSINESS - NEEDS TO BE rerun AND CORRECTED

I make the claim that when biological system sizes are large, a fixation time that scales exponentially with carrying capacity effectively implies coexistence. 
This is typically the case. 
However, some systems have only a few competing members, as in nascent cancers or plasmids in a single cell. 
I want to get a better sense of when the exponential scaling is relevant, especially since for those systems with almost complete niche overlap the exponential scaling is slow. 
To this end I compare the expected mean fixation time with that of the Moran model. 
The ansatz $e^{h(a)}K^{g(a)}e^{f(a)K}$ is fit to the data and then used to estimate the fixation time at a variety of parameter values. 
This time is compared to the fixation time of a Moran model with the same carrying capacity. 
In the right panel of figure \ref{ansatzplot} the shaded region represents those parameter combinations for which the estimated fixation is faster than the corresponding Moran model. 
For example, a carrying capacity of about $35$ organisms is sufficient to allow for effective coexistence of two species which are not more than $99\%$ identical in their niches. This is a small population size in most biological contexts. 
%As is evident, a carrying capacity of forty is fully sufficient to allow for effective coexistence of two species which are not identical in their niches. 
Even for systems with a smaller carrying capacity, unless the two species are more similar they are expected to coexist for long times before fixation. 
%The funny curvature at $K=5$ comes from an extrapolation of the ansatz to low numbers; for a system with such a small carrying capacity, the simplifying assumptions underlying the model are expected to break down. 
%~$99\%$ niche overlap means 35 organisms is when Moran is faster


%\section{Fokker-Planck and the inability to write a potential}
\section{Analysis of the Fokker-Planck approximation in this context} \label{FPsection}
%explain that we do this so that we can have an analytic estimate of the dependence of tau on K and a
The most common approximation to the master equation is Fokker-Planck, which assumes the state space is continuous. 
I attempt its use here to get an analytic estimate of the dependence of fixation time on $K$ and $a$. 
We shall see that its utility is only marginal, though with some further approximations and an application of Kramers' theory I get my desired estimate. 

The Fokker-Planck approximation to the coupled logistic system studied herein takes its traditional form \cite{Nisbet1982}:
\begin{align}
\frac{dP}{dt} &= - \partial_1[(b_1-d_1)P] - \partial_2[(b_2-d_2)P] + \frac{1}{2}\partial_1^2[(b_1+d_1)P] + \frac{1}{2}\partial_2^2[(b_2+d_2)P] \notag \\
&= -\sum_{i} \partial_i F_iP + \sum_{i,j} \partial_i\partial_j D_{ij}P \label{FP}
\end{align}%(x_1,x_2,t) or (s,t)
where $F$ is the force vector and $D$ is the diffusion matrix (in this case diagonal). 
Here, under symmetric conditions and nondimensionalization by $r$, $F_1 = \frac{x_1}{K}(K - x_1 - a x_2)$ and $D_{11} = \frac{x_1}{K}(K + x_1 + a x_2)$, with similar terms for species 2. 
\iffalse%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
We want to write these force terms using a scalar potential, $F=-\nabla U$. %explain WHY we want - why not just solve backward fokker-planck
%cite quasi-potential paper
If this were possible, it would imply that $\nabla \times F = -\nabla \times \nabla U = 0$. 
However,% $|\nabla \times F| = |\partial_1 F_2 - \partial_2 F_1|$
\begin{align*}
|\nabla \times F| &= |\partial_1 F_2 - \partial_2 F_1| \\
&= |-a_{21}x_2/K + a_{12}x_1/K| \\
&\neq 0.
\end{align*}
%\fi
%One could write a vector potential... see that quasi/pseudo-potential paper
The steady state solution of equation \ref{FP} would solve
\begin{equation*}
\partial_i \log P = \sum_k (D^{-1})_{ik} \big( 2 F_k - \sum_j \partial_j D_{kj} \big) \equiv - \partial_i U,
\end{equation*}
where the final equivalence would define a potential for the system. 
However, for consistency this requires $\partial_j \left( - \partial_i U \right) = \partial_i \left( - \partial_j U \right)$ and it is easy to show that this is not upheld for the two directions unless $a_{12}=a_{21}=0$ and the system can be decomposed into two one-dimensional logistic systems. 
Effectively there is a non-zero curl in the system which disallows the writing of a potential unless it is simply a product of two independent systems. 
%\begin{equation*}
% - \partial_i U = \frac{K - 4x_i - 3a_{ij}x_j}{K + x_i + a_{ij}x_j}
%\end{equation*}
%\begin{equation*}
%- \partial_j \partial_i U = \frac{- a_{ij}(4K - x_i)}{(K + x_i + a_{ij}x_j)^2}
%\end{equation*}

%\section*{Linearized Fokker-Planck}
Though a potential cannot be written in our system, similar quantities can be constructed. 
In particular, we want to define
\begin{equation}
U(x_1,x_2) \equiv -\ln\left[P(x_1,x_2,t\rightarrow\infty)\right].
\label{quasipotential}
\end{equation}
Rather than getting this quasi-steady state probability from numerics, I approximate it by linearizing the Fokker-Planck equation (\ref{FP}) about the deterministic coexistence fixed point \cite{VanKampen1992}. 
This linearized equation is
\begin{equation}
\partial_t P = -\sum_{i,j} A_{ij}\partial_i x_j P + \sum_{i,j} B_{ij} \partial_i\partial_j x_i x_j P
\label{linFP}
\end{equation}
where $A_{ij}=\partial_j F_i \lvert_{\vec{x}=\vec{x}^*}$ and $B_{ij}=D_{ij} \lvert_{\vec{x}=\vec{x}^*}$. 
The solution to Equation \ref{linFP} is $P=\frac{1}{2\pi}\frac{1}{\mid C\mid^{1/2}}\exp[-(\vec{x} - \vec{x}^*)^T C^{-1}(\vec{x} - \vec{x}^*)/2]$, a Gaussian centered on the coexistence point and with a variance given by the covariance matrix $C$. 
%Steady state covariance can be attained by solving $\partial_t C = 0 = A.C + C.A^T + B$. 
%The covariance matrix is
%\begin{equation}
% \boldsymbol{C} = 
% \frac{-1}{(1 - a_{12} a_{21}) (a_{21} K_1^2 -2 K_1 K_2 + a_{12} K_2^2))}
%  \begin{pmatrix}
%   -a_{21} K_1^3 + (2 - a_{12} a_{21}) K_1^2 K_2 - a_{12} (1-a_{12}-a_{12} a_{21}) K_1 K_2^2 - a_{12}^3 K_2^3 & a_{21}^2 K_1^3 - a_{21} K_1^2 K_2 - a_{12} K_2^2 K_1  + a_{12}^2 K_2^3 \\
%   a_{21}^2 K_1^3 - a_{21} K_1^2 K_2 - a_{12} K_2^2 K_1  + a_{12}^2 K_2^3 & -a_{12} K_2^3 + (2 - a_{12} a_{21}) K_1 K_2^2 - a_{21} (1-a_{21}-a_{12} a_{21}) K_1^2 K_2 - a_{21}^3 K_1^3
%  \end{pmatrix}.
%\end{equation}
%WRITE the matrix solution earlier
%maybe skip the nonsymmetric case
%The covariance matrix $C$ has diagonal elements $C_{ii} = \frac{a_{ji} K_i^3 - (2 - a_{ij} a_{ji}) K_i^2 K_j + a_{ij} (1-a_{ij}-a_{ij} a_{ji}) K_i K_j^2 + a_{ij}^3 K_j^3}{(1 - a_{ij} a_{ji}) (a_{ji} K_i^2 -2 K_i K_j + a_{ij} K_j^2))}$ and off-diagonal elements $C_{ij} = \frac{-a_{ji}^2 K_i^3 + a_{ji} K_i^2 K_j + a_{ij} K_j^2 K_i  - a_{ij}^2 K_j^3}{(1 - a_{ij} a_{ji}) (a_{ji} K_i^2 -2 K_i K_j + a_{ij} K_j^2))}$. 
For the $a_{12}=a_{21}=a$, $K_1=K_2=K$ symmetric case the diagonal term of $C$ is $\frac{1}{1-a^2}K$ and the off-diagonal, which corresponds to the correlation between the two species, is $-\frac{a}{1-a^2}K$. 
%This allows us to write the Gaussian solution $P=\frac{1}{2\pi}\frac{1}{\mid C\mid^{1/2}}\exp[-(\vec{x} - \vec{x}^*)^T C^{-1}(\vec{x} - \vec{x}^*)/2]$ and hence a potential. 
Since we now have a probability density, I can write our pseudo-potential from Equation \ref{quasipotential}. 

With a pseudo-potential we can employ Kramers' theory, which states that the logarithm of the exit time should be proportional to the depth of this potential \cite{Hanggi1990}. 
%for a process which starts at...
By defining our starting point as the coexistence fixed point and estimating the exit to happen at one of the axial fixed points (eg. $(0,K)$) I get a well depth of
\begin{equation}
\Delta U = \frac{(1-a)}{2(1+a)}K. 
\end{equation}
As expected, the well depth is proportional to carrying capacity $K$. 
%This is good! 
%Kramer's theory suggests that extinction time should scale exponentially with the well depth. 
%Notice that well depth is proportional to carrying capacity $K$, and so e
Even the Gaussian approximation to the already approximate Fokker-Planck equation shows the extinction time scaling exponentially with $K$. 
What is more, the exponential scaling disappears as niche overlap $a$ approaches unity, just as with the ansatz (shown in the left panel of figure \ref{ansatzplot}). 
The correlation between the two species diverges in this parameter limit, such that they are entirely anti-correlated. 
Whereas the well has a single lowest point at the coexistence fixed point for partial niche overlap, at $a=1$ the potential shows a trough of equal depth going between the two axial fixed points. 
This is the Moran line, along which diffusion is unbiased; diffusion away from the Moran line is restored, as the system is drawn toward the bottom of the trough. 

%We can get a well depth for the case of broken niche overlap symmetry. Written with the asymmetry not obvious, it is
%\begin{equation}
% \frac{(1-a_{12})^2 (2-a_{12}-a_{21}) (2 - a_{21} + a_{12}^2 a_{21} + a_{21}^2 - a_{12} (1 + a_{21} + a_{21}^2))}{2 (1-a_{12} a_{21}) (4 - a_{12}^3 (1-a_{21}) - 4 a_{21} + 2 a_{21}^2 - a_{21}^3 + a_{12}^2 (2 + a_{21} - 2 a_{21}^2) - a_{12} (4-a_{21}^2-a_{21}^3))}. 
%\end{equation}
\fi%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In general, Equation (\ref{FP}) cannot be reduced to diffusion in a potential $U(\vec{x})$ with an equilibrium distribution function $P(\vec{x})\sim \exp(U(\vec{x}))$. The condition of zero flux at equilibrium, $J_i=F_iP - 1/2 \sum_{j}\partial_j D_{ij}P=0$, would require \cite{Gardiner2004}
\begin{equation*}
\partial_i \log P = \sum_k (D^{-1})_{ik} \big( 2 F_k - \sum_j \partial_j D_{kj} \big) \equiv - \partial_i U,
\end{equation*}
However, for consistency it also requires $\partial_j \left( - \partial_i U \right) = \partial_i \left( - \partial_j U \right)$ \cite{Gardiner2004}. 
It is easy to show that this is not upheld for the two directions unless $a_{12}=a_{21}=0$ and the system can be decomposed into two one-dimensional logistic systems.

%%%%%%%%%%%%%%%%%%[better?]
Instead, I define the pseudo-potential as:
\begin{equation}
U(x_1,x_2) \equiv -\ln\left[P_{ss}(x_1,x_2)\right].
\label{quasipotential}
\end{equation}
where $P_{ss}(x_1,x_2)$ is a quasi-stationary probability distribution function \cite{Zhou2012}. 
I calculate $P_{ss}(x_1,x_2)$ in the approximation to the Fokker-Planck Equation (\ref{FP}) linearized about the deterministic coexistence fixed point. 
The linearized equation is
\begin{equation}
\partial_t P = -\sum_{i,j} A_{ij}\partial_i (x_j-x_j^*) P + \frac{1}{2} \sum_{i,j} B_{ij} \partial_i\partial_j (x_i-x_i^*) (x_j-x_j^*) P
\label{linFP}
\end{equation}
where $A_{ij}=\partial_j F_i \lvert_{\vec{x}=\vec{x}^*}$ and $B_{ij}=D_{ij} \lvert_{\vec{x}=\vec{x}^*}$.
The quasi-equilibrium solution to Equation (\ref{linFP}) is $P_{ss}=\frac{1}{2\pi}\frac{1}{\mid C\mid^{1/2}}\exp[-(\vec{x} - \vec{x}^*)^T C^{-1}(\vec{x} - \vec{x}^*)/2]$, a Gaussian centered on the coexistence point and with a variance given by the covariance matrix $C=B\cdot A^{-1}/2$ in the symmetric case $a_{12}=a_{21}=a$, $K_1=K_2=K$ \cite{VanKampen1992}. 
In this case the diagonal term of $C$ is $\frac{1}{1-a^2}K$ and gives the variance of a species about its mean value. 
The off-diagonal, which corresponds to the covariance between the two species, is $-\frac{a}{1-a^2}K$. 
Thus the Pearson correlation coefficient between the two species is $-a$. 
That is, they are maximally anti-correlated when $a=1$, lying along the line $x_1 + x_2 = K$ - the Moran line. 

For the initial condition at the coexistence fixed point and assuming that the system escapes towards fixation once it reaches one of the axial fixed points $(0,K)$ or $(K,0)$, from Equation (\ref{quasipotential}) the well depth is proportional to carrying capacity $K$, being
\begin{equation}
\Delta U = \frac{(1-a)}{2(1+a)}K.
\end{equation}
%and proportional to carrying capacity $K$.
In a Kramers' type approximation, the escape time from the pseudo-potential well scales as $\sim \exp(\Delta U)$ \cite{Hanggi1990}, reproducing the exponential scaling of the extinction time with $K$, observed numerically.  Moreover, the Fokker-Planck approximation also shows that the exponential scaling disappears as niche overlap $a$ approaches unity, in accord with the numerical results above. 
%%%%%%%%NEED TO DISCUSS THIS CORRELATION BUSINESS
The correlation between the two species goes to negative one in this parameter limit, such that they are entirely anti-correlated. 
Whereas the well has a single lowest point at the coexistence fixed point for partial niche overlap, at $a=1$ the potential shows a trough of constant depth going between the two axial fixed points. 
% [I HAVE  A PROBLEM WITH THIS: THE TROUGH DOES NOT HAVE A DEPTH, THE P is going to zero, no?]. 
This is the Moran line, along which diffusion is unbiased; diffusion away from the Moran line is restored, as the system is drawn toward the bottom of the trough. 
Because everywhere along the Moran line is equally likely, the probability cannot be normalized, and the linearization approximation fails. This is to be expected, as it is an expansion about a fixed point, but the fixed point is replaced by the Moran line in the Moran limit of $a=1$. 


\section{Breaking the parameter symmetries}
I have addressed the symmetric case of $K_1 = K_2 \equiv K$ and $a_{12} = a_{21} \equiv a$. 
The result of exponential scaling of the fixation time except when the Moran line exists is true even when some symmetries are broken. 
% but neither of these simplifications are strictly necessary. 
However, the evidence is not as clear as in the symmetric case. 

\iffalse
%\begin{figure}%[ht]
%	\centering
%	\includegraphics[width=0.7\textwidth]{asym-K1overK2is1a12is5-new.pdf}
%	\caption{\emph{Breaking the symmetry in $a$.} As in Figure 2 in the main text, lines come from fitting the ansatz to generated data. The exponential dependence is non-zero except at $a_{21}=1$, at which point the ``coexistence'' fixed point is coincident with the fixed point on the $x$-axis. } %write what a_{12} is (0.5)
%	%\emph{Right: niche overlap controls the transition from coexistence to fixation.}
%	%Blue line: $f(a)$ from the ansatz of equation \ref{ansatz} characterizes the exponential dependence of the fixation time on $K$; it  smoothly approaches zero as the niche overlap reaches its Moran line value $a=1$. Green line: $g(a)$ quantifies the scaling of the pre-exponential prefactor $K^{g(a)}$ with $K$. Yellow line: $h(a)$ is the multiplicative constant. Dashed bars represent a 95\% confidence interval. The dots at the extremes $a=0$ and $a=1$ are the expected asymptotic values.
%	\label{asymmetrica}
%\end{figure}
\begin{figure}[ht]
	\centering
	\begin{minipage}{0.49\linewidth}
		\centering
		\includegraphics[width=0.95\textwidth]{asym-K1overK2is1a12is5-new.pdf}
	\end{minipage}
	\begin{minipage}{0.49\linewidth}
		\centering
		\includegraphics[width=0.95\textwidth]{asym-vs-Gaussian}
	\end{minipage}
	\centering
	\caption{\emph{Breaking the symmetry in $a$.} As in Figure 2 in the main text, lines come from fitting the ansatz to generated data. The exponential dependence is non-zero except at $a_{21}=1$, at which point the ``coexistence'' fixed point is coincident with the fixed point on the $x$-axis. The right panel compares this ansatz fit with the Gaussian well depth at the same parameter values. } %write what a_{12} is (0.5)
	\label{asymmetrica}
\end{figure}% from equations (\ref{morantime}) and (\ref{indietime}), which varies from $g(a)=-1$ for the independent processes to $g(a)=1$ in the WFM limit

For instance, rather than investigating along the line $a_{12} = a_{21}$ as in the left panel of Figure \ref{phasespace}, one could instead consider a horizontal line in $a_{12}-a_{21}$ space. 
Keeping the $K_{ij}$'s still equal, I apply the same $e^{h(a_{21})}K^{g(a_{21})}e^{f(a_{21})K}$ ansatz to fixation time data generated with $a_{12}$ held at $a_{12}=0.5$, allowing $a_{21}$ to vary between $0$ and $1$. 
This generates panel A of figure \ref{asymmetricaK}. % above. 
Similar to the corresponding figure \ref{ansatzplot}, it is evident that the fixation time only loses its exponential scaling with carrying capacity when $a_{21}=1$. 
As $a_{21}$ approaches $1$, however, the fixed point is not replaced by the Moran line of semi-stable fixed points, but rather merges with the fixed point on $x$-axis (specifically, at $(K,0)$), and the fixation time starting from the fixed point is exactly zero. 
The exponential dependence is lost, but for a different reason. 
%This is also why the exponential term was not as relevant in the first place. 
Even prior to this merging, moving the fixed point, the point about which the system fluctuates, closer to an axis is similar to decreasing the effective carrying capacity, hence the scaling with the true carrying capacity is lessened. 
This partially explains why the exponential fit parameter $f(a_{21})$ is weak even when $a_{21}=0$. 
Panel B of figure \ref{asymmetrica} shows the comparison of the ansatz fit with the pseudo-potential well of the previous section. 
The Gaussian pseudo-potential shows a similar trend, though quantitatively it remains incorrect. 
\fi

\begin{figure*}[h]
	\centering
	\begin{minipage}[b]{0.475\textwidth}
		\centering
		\includegraphics[width=\textwidth]{asym-K1overK2is1a12is5-new.pdf}
		%\caption[Network2]%
		{{A}}
		%\label{fig:mean and std of net14}
	\end{minipage}
	\hfill
	\begin{minipage}[b]{0.475\textwidth}  
		\centering 
		\includegraphics[width=\textwidth]{asym-vs-Gaussian}
		%\caption[]%
		{{B}}    
		%\label{fig:mean and std of net24}
	\end{minipage}
	\vskip\baselineskip
	\raggedright
	\begin{minipage}[b]{0.475\textwidth}   
		\centering 
		\includegraphics[width=\textwidth]{asym-K1overK2is2a12overa21is4.pdf}
		%\caption[]%
		{{C}}    
		%\label{fig:mean and std of net34}
	\end{minipage}
	\caption{\emph{Breaking the parameter symmetries.}
		\emph{Panel A:} As in figure \ref{ansatzplot}, lines come from fitting the ansatz of equation \ref{ansatz} to data generated from equation \ref{explicit-tau}. In this case the niche overlap symmetry is broken and $a_{12}=0.5$. The exponential dependence on carrying capacity is non-zero except at $a_{21}=1$, at which point the ``coexistence'' fixed point is coincident with the fixed point on the $x$-axis. 
		\emph{Panel B:} The ansatz fit from panel A is compared with the Gaussian well depth at the same parameter values. The non-zero exponential dependence is observed in the Gaussian approximation as well. 
		\emph{Panel C:} The symmetry is broken in carrying capacity, such that $K_2=2K_1$. The ansatz is fit to $K_1$. The exponential dependence is non-zero except at the appearance of the Moran line at $a_{21}=1/2$. The extreme points are the expected asymptotic values. 
	} \label{asymmetricaK}
\end{figure*}

Panel A of figure \ref{asymmetricaK} shows the dependence of the fixation time on the niche overlap $a_{21}$ while keeping $a_{12}=0.5$ for $K_1=K_2\equiv K$; using the similar ansatz, I apply the same $\tau=e^{h(a_{21})}K^{g(a_{21})}e^{f(a_{21})K}$. 
As the niche overlap $a_{21}$ changes from $0$ to $1$, the location of the coexistence fixed point shifts from $(K/2,K/4)$ to $(K,0)$. 
Accordingly, the fixation time starting from the fixed point maintains its exponential scaling with carrying capacity up until $a_{21}=1$, where the fixed time is equal to zero, as reflected in the shape of the of $h(a_{21})$. 
Notably, in this asymmetric case the exponential scaling function $f(a_{21})$ is much weaker compared to the symmetric case, partially because the fixed point is located closer to an axis that in the symmetric case even at $a_{21}=0$. 
Panel B of Figure \ref{asymmetricaK} shows the comparison of the results of the ansatz fit with the estimates of the exponential part of the fixation time using Kramers'/Fokker-Planck pseudo-potential described in the previous section that explains the observed trends of $f(a_{21})$. 
The Gaussian pseudo-potential shows a similar trend to the data, though quantitatively it remains incorrect. 

\iffalse
\begin{figure}[ht]
	\centering
	\includegraphics[width=0.7\textwidth]{asym-K1overK2is2a12overa21is4.pdf}
	\caption{\emph{Breaking the symmetry in $K$.} As in Figure 2 in the main text, lines come from fitting the ansatz to generated data. The exponential dependence is non-zero except at the appearance of the Moran line at $a_{21}=1/2$. The extreme points are the expected asymptotic values. }
	%\emph{Right: niche overlap controls the transition from coexistence to fixation.}
	%Blue line: $f(a)$ from the ansatz of equation \ref{ansatz} characterizes the exponential dependence of the fixation time on $K$; it  smoothly approaches zero as the niche overlap reaches its Moran line value $a=1$. Green line: $g(a)$ quantifies the scaling of the pre-exponential prefactor $K^{g(a)}$ with $K$. Yellow line: $h(a)$ is the multiplicative constant. Dashed bars represent a 95\% confidence interval. The dots at the extremes $a=0$ and $a=1$ are the expected asymptotic values.
	\label{asymmetricK}
\end{figure}

Next let us consider breaking the symmetry such that the Moran line can still be recovered, in a range more analogous to the parameter range explored in the symmetric case. 
The carrying capacity symmetry is broken, such that $K_2 = 2 K_1$. 
The two species are still independent when $a_{12}=a_{21}=0$, but in this case the Moran line exists when $a_{12} = 2$ and $a_{21} = 1/2$. 
Panel C of figure \ref{asymmetricaK} shows the ansatz explored along $a_{12}=4 a_{21}$. %, as $a_{21}$ varies between the independent and Moran limits. 
These niche overlap parameters are chosen such that they range from independence of both species when $a_{12} = a_{21} = 0$, to those that create the Moran line. % in the other extreme. 
The behaviour is very similar to that shown previously, with the exponential dependence transitioning smoothly to zero only at the Moran line. 
%Thus w
I uphold my conclusion that only at the Moran line will fixation be fast; when the system parameters are even slightly off those niche overlap values which balance the carrying capacities and allow for the Moran line to exist, the fixation is exponential in the carrying capacity. % to the point that the two species effectively coexist. 
%For large carrying capacities we again conclude that the exponential implies effective coexistence
I include the caveat that fixation will also be fast when the coexistence fixed point is close to one axis, as evinced with the broken niche overlap ($a$) symmetry above. 
\fi

Next let us consider breaking the symmetry such that the Moran line can still be recovered.
The carrying capacity symmetry is broken, such that $K_2 = 2 K_1$.
The two species are still independent when $a_{12}=a_{21}=0$, but in this case the Moran line exists when $a_{12} = 2$ and $a_{21} = 1/2$.
Figure \ref{asymmetricK} shows the results when the symmetry is broken both in the carrying capacity and the niche overlap.
It shows the change in the fixation time as a function of the niche overlap $a_{21}$ for $K_2=2K_1\equiv K$ while the niche overlaps change along the line where $a_{12}=4 a_{21}$, starting from the independent case $a_{12}=a_{21}=0$ to $a_{12} = 2$ and $a_{21} = 1/2$ where the system reaches its corresponding Moran line.
The observed behaviour is very similar to that shown in the symmetric case, with the exponential dependence transitioning smoothly to zero at the Moran line.

%Thus we uphold...
I uphold the conclusion that at the Moran line will fixation be fast; when the system parameters are even slightly off those niche overlap values which balance the carrying capacities and allow for the Moran line to exist, the fixation is exponential in the carrying capacity, to the point that the two species effectively coexist. 
%For large carrying capacities we again conclude that the exponential implies effective coexistence
I include the caveat that fixation will also be fast when the coexistence fixed point is close to one axis, as evinced with the broken niche overlap symmetry above. 
%NTS:::some other summary sentences


\iffalse
\subsection{1D FP and WKB screw the prefactor - just remind from previous chapter}
%NTS:::put/emphasize this in the previous chapter.
The Fokker-Planck equation for extinction time is \cite{Nisbet1982}
\begin{equation}
-\frac{1}{r} = \frac{n}{K}(K-n)\frac{\partial\tau_{FP}}{\partial n}+\frac{1}{2}\frac{n}{K}(K+n)\frac{\partial^2\tau_{FP}}{\partial n^2}.  
\end{equation}
The solution to this equation is
\begin{equation} \label{fpe-etime}
r\,\tau_{FP}[n_0] = \int^{n_0}_0 dn\frac{\int_n^\infty dm\frac{2K}{m(K+m)}\exp[\int^m_0dn'\frac{2(K-n')}{(K+n')}]}{\exp[\int^n_0dm\frac{2(K-m)}{(K+m)}]}.  
\end{equation}
It is difficult to solve analytically. 
If we approximate the underlying population distribution as Gaussian, however, an analytic solution is easy to obtain:
\begin{equation}
r\,\tau_{FP} \approx 2\sqrt{2\pi K}e^{K/2}. 
\end{equation}

The WKB approximation can also estimate the mean time to extinction \cite{Assaf2016}. 
It assumes a quasi-steady state population probability distribution of
\begin{equation}
P_n \propto \exp\left[-K\sum_{i=0}^\infty \frac{S_i(n)}{K^i}\right]. 
\end{equation}
The extinction time is estimated from the quasi-steady state distribution as $\tau \approx 1/(d(1)P_1)$ \cite{Nisbet1982,Assaf2016}. 
Including only the $S_0$ term gives
\begin{equation}
r\,\tau_{FP} = \sqrt{2\pi K}e^{-1}e^K. 
\end{equation}

Comparing to the asymptotic solution of equation \ref{1Dlog}, the Fokker-Planck equation with the further Gaussian approximation does not get the exponential scaling correct, being off by a factor of $1/2$ on a log-linear plot. 
The WKB approximation at least gets the correct exponential scaling. 
However, it gets an incorrect prefactor, being $\propto \sqrt{K}$ rather than $\propto K^{-1}$ as shown to be asymptotically correct for equation \ref{1Dlog}. 
\fi
%%%!!!WKB has a ``typical'' trajectory!!!


\section{Route to Fixation}
%NTS:::refer to the previous chapter, as this is a comment on WKB
\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{{RouteToFixation}}
	\caption{\emph{The system samples multiple trajectories on its way to fixation.}  Contour plot shows the average residency times at different population states of the system, with pink indicating longer residence time, deep green indicating rarely visited states. The colored line is a sample trajectory the system undergoes before fixation; color coding corresponds to the elapsed time with orange at early times, purple at the intermediate times and red at late stages of the trajectory. The red dot shows the deterministic coexistence point. See text for more details. \emph{Left}: Complete niche overlap limit, $a=1$, for $K=64$. \emph{Right}: Independent limit with $a=0$ and $K=32$. % Note that only one per million trajectory points are included, since most of the trajectory is very close tp the deterministic fixed point.
	} \label{extinctionroutes}
\end{figure}
%guassian potentials in insets!!!

To gain deeper insight into the fixation dynamics, in this section I calculate the residency times in each state during the fixation process \cite{Grinstead2003}, given by Equation (\ref{residence-time}), reproduced here:
\begin{equation*}
\langle t(s^0)\rangle_s = \int_0^{\infty} dt P(s,t|s^0,0)=\hat{M}^{-1}_{s,s^0}.
\end{equation*}
This gives the mean total time the system resides in state $s$, given that it starts in state $s^0$. 
As with the fixation times, the dependence on the initial state is weak, so long as that initial state is not near an axis. 
Whereas I previously analyzed the fixation time scaling, the residency times themselves proffer some insight into the system. 
The results are shown as a contour plot in figure \ref{extinctionroutes}, where  pink  corresponds to the high occupancy sites and green to the rarely visited ones, for two different niche overlaps, one at and the other far from the Moran limit. 
The set of states lying along the steepest descent lines of the contour plot, shown as the black line, can be thought of as a ``typical'' trajectory \cite{Gabel2013,Matkowsky1984,Kessler2007,McKane2004,Baxter2005}. 
However, even for two species close to complete niche overlap the system trajectory visits many states far from this line. 
This departure is even greater for weakly competing species, where the system covers large areas around the fixed point before the rare fluctuation that leads to fixation occurs \cite{Gottesman2012}. 
These deviations from a ``typical'' trajectory are related to the inaccuracy of the WKB approximation in calculating the scaling of the pre-exponential factor \cite{Assaf2016,Gottesman2012,Lande1993,Assaf2010}; see also the previous chapter. %NTS:::WKB has a typical trajectory? Was that in the previous chapter?? 

%NTS:::write more about gaussian business
This occupancy landscape can be qualitatively thought of as an effective Lyapunov function/effective potential of the system dynamics \cite{Zhou2012}, although the LV system does not possess a true Lyapunov function - an issue that also arises in the Fokker-Planck approximation \cite{Zhou2012,Chotibut2015}. 
One way to deal with this issue is the linearization in the Fokker-Planck section above (section \ref{FPsection}). 
This allows one to easily solve the Fokker-Planck equation in any system with an attractive deterministic fixed point. 
More pertinently, linearizing the Fokker-Planck equation, as in Equation \ref{linFP} described above, allows one to get an estimate of the depth of the pseudo-potential: $\frac{(1-a)}{2(1+a)}K$. 
%%Nevertheless, it 
This provides an intuitive underpinning for the general exponential scaling in the incomplete niche overlap regime: the fixation process can be thought of as the Kramers'-type escape from a pseudo-potential well \cite{Berglund2011}. 
The Kramers result is dominated by $\tau \simeq \exp(\text{well depth})$, corresponding to the dominant scaling $\tau \simeq \exp(f(a)K)$. 
As $a$ increases and the species interact more strongly, the potential well becomes less steep, resulting in weaker exponential scaling. 
In the complete niche overlap limit, the pseudo-potential develops a soft direction along the Moran line that enables relatively fast escape towards fixation.
This is what is seen in the residence time graph; in the Moran limit, the states along the line connecting the coexistence fixed point to the two axial fixed points are visited much more frequently than those off it. Outside of the Moran limit, it is rather the states in a cloud around the coexistence point that enjoy long residence times. 

In linearizing the FP equation I also arrived at the Pearson correlation coefficient between the two species: $-a$. 
They are anti-correlated, and this anti-correlation becomes complete as niche overlap approaches one. 
In state space this corresponds to the system lying on the Moran line. 
Thus we expect the pseudo-potential to become less steep as $a$ increases, eventually developing a level trough along the Moran line that enables relatively fast escape toward fixation. 
%NTS:::This is also mirrored in the coexistence point eigenvalue associated with the $(1,-1)$ direction going to zero at complete niche overlap. 
Though I am unaware of any direct connection, this disappearance is also mimicked in the deterministic coexistence point eigenvalue associated with the $(1,-1)$ direction, which goes to zero as niche overlap goes to one, as $-\frac{1-a}{1+a}$. %!!!


\section{Discussion}
%NTS:::as with the intro, think how much should be here versus in the other places
%NTS:::uncomment a bunch of stuff??
Maintenance of species biodiversity in many biological communities is still incompletely understood. 
The classical idea of competitive exclusion postulates that ultimately only one species should exist in an ecological niche, excluding all others. 
Although the notion of an ecological niche has eluded precise definition, it is commonly related to the limiting factors that constrain or affect the population growth and death. 
In the simplest case, one factor corresponds to one niche, which supports one species, although a combination of factors may also serve as a niche, as discussed above. 
The competitive exclusion picture has encountered long-standing challenges as exemplified by the classical ``paradox of the plankton'' \cite{Hutchinson1961,Chesson2000} in which many species of plankton seem to co-habit the same niche; in many other ecosystems the biodiversity is also higher than appears to be possible from the apparent number of niches \cite{MacArthur1957,Shmida1984,May1999,Chesson2000,Hubbell2001}.

Competitive exclusion-like phenomena can appear in a number of popular mathematical models, for instance in the competition regime of the deterministic Lotka-Volterra model, whose extensive use as a toy model enables a mathematical definition of the niche overlap between competing populations \cite{MacArthur1967,Abrams1980,Schoener1985,Chesson2008}. 
Another classical paradigm of fixation within an ecological niche is the Moran model (and the closely related Fisher-Wright, Kimura, and Hubbell models) that underlies a number of modern neutral theories of biodiversity \cite{Moran1962,Lin2012,Kimura1968,Kingman1982,Hubbell2001,Abrams1983,Mayfield2010}. 
Unlike the deterministic models, in the Moran model fixation does not rely on deterministic competition for space and limiting factors but arises from the stochastic demographic noise. 
Recently, the connection between deterministic models of the LV type and stochastic models of the Moran type has accrued renewed interest because of new focus on the stochastic dynamics of the microbiome, immune system, and cancer progression \cite{Antal2006,Lin2012,Constable2015,Chotibut2015,Ashcroft2015,Assaf2016,Vega2017,Posfai2017}. % [[MORE CITATIOS: TALK TO ME IF In trouble. Definitely add all the Nelson and Meerson/Redner, Gore]].!!!!%cancer, some theory, some experimental reviews, microbiome, lungs? %NTS:::was this sentence repeated earlier?!?
%cite Gore for competition!!!
%not experimental
%Remarkably, the stochastic dynamics of LV type models is still incompletely understood, and has recently received renewed attention motivated by problems in bacterial ecology and cancer progression \cite{VanMelderen2009,Stirk2010,Fisher2014,Chotibut2015,Capitan2017,Kessler2015}. %cut Nowak 2006.

Much of the recent studies of these systems employed various approximations, such as the Fokker-Planck approximation \cite{Chotibut2015,Dobrinevski2012,Fisher2014,Constable2015,Lin2012}, WKB approximation \cite{Kessler2007,Gabel2013} or game theoretic \cite{Antal2006} approach. 
The results of these approximations typically differ from the exact solution of the master equation, especially for small population sizes \cite{Doering2005,Kessler2007,Ovaskainen2010,Assaf2016,Badali2018}, as was discussed in more detail in the previous chapter. 
In this chapter, I have interrogated stochastic dynamics of a system of two competing species using a numerically arbitrarily accurate method based on the first passage formalism in the master equation description. 
The algorithmic complexity of this method scales algebraically with the population size rather than with the exponential scaling of the fixation time, (as is the case with the Gillespie algorithm \cite{Gillespie1977}) enabling us to capture both the exponential behaviour and the algebraic prefactors in the fixation/extinction times for both small and large population sizes. %really it only captures the mean rather than the exponential tail, but the point is it's not an approximation that ignores the tail nor with underlying assumptions about the solution except that it's rare for fluctuations to reach $C_K$ %NTS:::this comment?
This accuracy is needed in order to observe the transition from slow, exponentially dominated processes to the algebraically fast fixation of the Moran limit. 

Stochastic fluctuations allow the system to escape from the deterministic coexistence fixed point towards fixation. 
If the escape time is exponential in the (typically large) system size, in practice it implies effective coexistence of the two species around their deterministic coexistence point. 
If the time is algebraic in $K$, as in degenerate niche overlap case (closely related to the classical Moran model), the system may fixate on biological timescales \cite{Kimura1964,Moran1962}. 
For those biological systems with small characteristic population sizes, exponential scaling does not dominate the fixation time; power law and prefactor become more relevant. 
Figure \ref{coexistvsfixate} shows that a niche overlap as low as $0.8$, for a carrying capacity around $6$, has rapid fixation, more rapid than a corresponding Moran model. %NTS:::grossly too specific
The transition between the exponential scaling of effective coexistence time to the rapid stochastic fixation in the Moran limit is governed by the niche overlap parameter, which for example can be derived in terms of the dynamics and interactions of the species and their secreted growth and death factors. %, as seen in section II. 
% which can be derived in terms the dynamics of the species turnover governed by the exchange of the secreted growth and death factors (section II)[PLEASE CHECK - I do not understand this clause and it is anyways only an example, not a general statement]

While I find that the fixation time is exponential in the system size unless the two species occupy exactly the same niche, the numerical factor in the exponential is highly sensitive to the value of the niche overlap, and smoothly decays to zero in the complete niche overlap case. 
These results can be understood by noticing that the escape from a deterministically stable coexistence fixed point can be likened to Kramers' escape from a pseudo-potential well \cite{Bez1981,Hanggi1990,Ovaskainen2010,Dobrinevski2012}, where the mean transition time grows exponentially with well depth \cite{Ovaskainen2010}. % [WHY IS WELL DEPTH PROPORTIONAL to f(a)K? CAN WE SHOW IT SOMEHOW? - [[if T=Exp[welldepth] and T=Exp[f(a)K] then it stands to reason. AZ: THIS IS CIRCULAR. IS THERE AN INDEPENDENT WAY ]]. !!!!!
Approximating the steady state probability with a Gaussian shows that this well depth is proportional to $K(1-a)$ and disappears when $a=1$. 
With complete niche overlap the system develops a ``soft'' marginally stable direction along the Moran line that enables algebraically fast escape towards fixation \cite{Dobrinevski2012,Chotibut2015}. 
Similar to the exponential term, the exponent of the algebraic prefactor is also a function of the niche overlap, and smoothly varies from $-1$ in the independent regime of non-overlapping niches to $+1$ in the Moran limit. 

%The fixation times of two co-existing species, discussed above, determine the timescales over which the stability of the mixed populations can be destroyed by stochastic fluctuations. Similarly, the times of successful and failed invasions set the timescales of the expected transient co-existence in the case of an influx of invaders, arising from mutation, speciation, or immigration. For species with low niche overlap, the probability of invasion is likely, and for large $K$ decreases monotonically as $1-a$ with the increase in niche overlap, independent of the population size $K$. The mean time of successful invasion is relatively fast in all regimes, and scales linearly or sublinearly with the system size $K$ and is typically increasing with the niche overlap $a$ (see also below).
%
%High niche overlap makes invasion difficult due to strong competition between the species. In this regime, the times of the failed invasions become important because they set the timescales for transient species diversity. If the influx of invaders is slower than the mean time of their failed invasion attempts, most of the time the system will contain only one settled species, with rare ``blips'' corresponding to the appearance and quick extinction of the invader. On the other hand, if individual invaders arrive faster than the typical times of extinction of the previous invasion attempt, the new system will exhibit transient co-existence between the settled species and multiple invader strains, determined by the balance of the mean failure time and the rate of invasion \cite{Dias1996,Hubbell2001,Chesson2000}. 
%Full discussion of diversity in this regime is beyond of the scope of the present work and will be studied elsewhere. % \cite{Dias1996,Hubbell2001,Chesson2000}. 
%The weaker dependence of the invasion times on the population size and the niche overlap, as compared to the escape times of a stably co-existing system to fixation, imply that the transient co-existence is expected to be much less sensitive to the niche overlap and the population size than the steady state co-existence. Curiously, both niche overlap and the population size can have contradictory effects on the invasion times (as discussed in section III) resulting in a non-monotonic dependence of the times of both successful and failed invasions on these parameters.

%Our results suggest that even minute differences in niche overlap, i.e. in how different species interact with their shared environment, allow them to coexist. % \cite{Hutchinson1961,May1999}
Niche overlap between two species, the similarity in how they interact with their shared environment, is of critical importance in determining whether they will coexist. 
%Still, for large  populations, the coexistence time depends strongly on the niche overlap between the species through the character of the escape time $\sim \exp(f(a)K)$. [nEEDS one  more revisionnn]. !!!!!!!
For typically large biological populations, effective coexistence occurs when escape time grows exponentially with the carrying capacity, which is the case for even slightly mismatched niches. 
Any niche mismatch leads to species which tend to exist for long times near their respective carrying capacities; in effect, niche models are apt even for large niche overlap. 
Only when niche overlap is complete will fixation be relatively rapid, algebraic in $K$. 
%For small carrying capacity systems, the situation is more complicated...
%For smaller populations, the pre-exponential term starts to become important. %NTS:::include a line about this?
This has important implications for understanding the long term population diversity in many systems, such as human microbiota in health and disease \cite{Coburn2015,Palmer2001,Kinross2011}, industrial microbiota used in fermented products \cite{Wolfe2014}, and evolutionary phylogeny inference algorithms \cite{Rice2004,Blythe2007}. 
My results show that the generalized Lotka-Volterra model serves well as an extension to neutral models for problems such as maintenance of drug resistance plasmids in bacteria \cite{Gooding-townsend2015}, strain survival in cancer progression \cite{Ashcroft2015}, or the generation of coalescent or phylogenetic trees \cite{Kingman1982,Rice2004,Rogers2014}. 
The theoretical results can also be tested and extended based on experiments in more controlled environments, such as the gut microbiome of a \textit{c. elegans} \cite{Vega2017}, or in microfluidic devices \cite{Hung2005}. %more in the final chapter 4

%The important comparison, the main result of the paper, is between competing species that have complete niche overlap, compared to pairs where there is a slight niche overlap:
%in the former case we expect the mean time to fixation to grow linearly with the system size, whereas in the latter case the fixation time should have some exponential component, allowing for much longer coexistence times.
%There are also implications for coalescent theories, the simplest of which rely on WFM-like dynamics to generate phylogenetic trees; by underestimating the mean time to fixation, two species are presumed to be more closely related than they are, hence the observed genetic differences come from lower mutation rates than are inferred\cite{Rice2004,Rogers2014}.

%%\section{conclusion}
%With complete niche overlap, the model presented in this Letter matches the results of the WFM model in terms of reproducing a rapid neutral drift to fixation, with appropriate scaling in terms of the initial fraction and the system size.
%But the coupled logistic model also goes beyond the WFM model to account for a variable population size and continuous time.
%By solving the backward master equation to arbitrary accuracy we are able to investigate the behaviour of the fixation time as it depends on the carrying capacity of the system and the niche overlap of the two species therein.
%The two limits of niche overlap give the expected results of the WFM and independent cases.
%It is the transition between the two that is of particular interest.
%We observe that even a slight mismatch between the niches of two species allows for coexistence of those species for long timescales.
